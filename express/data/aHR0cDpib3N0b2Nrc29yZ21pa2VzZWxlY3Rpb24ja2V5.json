{"html":"<header>\n  <aside>April 26, 2013</aside>\n  <a href=\"../\" rel=\"author\">Mike Bostock</a>\n</header>\n\n<h1>How Selections Work</h1>\n\n<blockquote>\n  <q>Any sufficiently advanced technology is indistinguishable from magic.</q>\n  –Arthur C. Clarke\n</blockquote>\n\n<script src=\"http://d3js.org/d3.v3.min.js\"></script>\n<script>\n\nvar numbers = [4, 5, 18, 23, 42];\n\nvar letters = [\n  {name: \"A\", frequency: .08167},\n  {name: \"B\", frequency: .01492},\n  {name: \"C\", frequency: .02780},\n  {name: \"D\", frequency: .04253},\n  {name: \"E\", frequency: .12702}\n];\n\nvar vowels = [\n  {name: \"A\", frequency: .08167},\n  {name: \"E\", frequency: .12702},\n  {name: \"I\", frequency: .06973},\n  {name: \"O\", frequency: .07507},\n  {name: \"U\", frequency: .02758}\n];\n\nvar matrix = [\n  [ 0,  1,  2,  3],\n  [ 4,  5,  6,  7],\n  [ 8,  9, 10, 11],\n  [12, 13, 14, 15]\n];\n\nfunction name(d) {\n  return d.name;\n}\n\nvar margin = {top: 0, right: 40, bottom: 0, left: 40},\n    width = 720,\n    step = 100;\n\nfunction tree(leftRoot, rightRoot, outerHeight) {\n  if (arguments.length < 3) outerHeight = rightRoot, rightRoot = null;\n\n  var height = outerHeight - margin.top - margin.bottom;\n\n  var tree = d3.layout.tree()\n      .size([height, 1])\n      .separation(function() { return 1; });\n\n  var svg = d3.select(\"body\").append(\"svg\")\n      .attr(\"width\", width + margin.left + margin.right)\n      .attr(\"height\", height + margin.top + margin.bottom)\n      .style(\"margin\", \"1em 0 1em \" + -margin.left + \"px\");\n\n  var g = svg.selectAll(\"g\")\n      .data([].concat(\n        leftRoot ? {type: \"left\", nodes: tree.nodes(leftRoot)} : [],\n        rightRoot ? {type: \"right\", nodes: tree.nodes(rightRoot).map(flip), flipped: true} : []\n      ))\n    .enter().append(\"g\")\n      .attr(\"class\", function(d) { return d.type; })\n      .attr(\"transform\", function(d) { return \"translate(\" + (!!d.flipped * width + margin.left) + \",\" + margin.top + \")\"; });\n\n  var link = g.append(\"g\")\n      .attr(\"class\", \"link\")\n    .selectAll(\"path\")\n      .data(function(d) { return tree.links(d.nodes); })\n    .enter().append(\"path\")\n      .attr(\"class\", linkType);\n\n  var node = g.append(\"g\")\n      .attr(\"class\", \"node\")\n    .selectAll(\"g\")\n      .data(function(d) { return d.nodes; })\n    .enter().append(\"g\")\n      .attr(\"class\", function(d) { return d.type; });\n\n  node.append(\"rect\");\n\n  node.append(\"text\")\n      .attr(\"dy\", \".35em\")\n      .text(function(d) { return d.name; })\n      .each(function(d) { d.width = Math.max(32, this.getComputedTextLength() + 12); })\n      .attr(\"x\", function(d) { return d.flipped ? 6 - d.width : 6; });\n\n  node.filter(function(d) { return \"join\" in d; }).insert(\"path\", \"text\")\n      .attr(\"class\", \"join\");\n\n  svg.call(reset);\n\n  function flip(d) {\n    d.depth *= -1;\n    d.flipped = true;\n    return d;\n  }\n\n  return svg;\n}\n\nfunction linkType(d) {\n  return d.target.type.split(/\\s+/).map(function(t) { return \"to-\" + t; })\n      .concat(d.source.type.split(/\\s+/).map(function(t) { return \"from-\" + t; }))\n      .join(\" \");\n}\n\nfunction reset(svg) {\n  svg.selectAll(\"*\")\n      .style(\"stroke-opacity\", null)\n      .style(\"fill-opacity\", null)\n      .style(\"display\", null);\n\n  var node = svg.selectAll(\".node g\")\n      .attr(\"class\", function(d) { return d.type; })\n      .attr(\"transform\", function(d, i) { return \"translate(\" + d.depth * step + \",\" + d.x + \")\"; });\n\n  node.select(\"rect\")\n      .attr(\"ry\", 6)\n      .attr(\"rx\", 6)\n      .attr(\"y\", -10)\n      .attr(\"height\", 20)\n      .attr(\"width\", function(d) { return d.width; })\n    .filter(function(d) { return d.flipped; })\n      .attr(\"x\", function(d) { return -d.width; });\n\n  node.select(\".join\")\n      .attr(\"d\", d3.svg.diagonal()\n        .source(function(d) { return {y: d.width, x: 0}; })\n        .target(function(d) { return {y: 88, x: d.join * 24}; })\n        .projection(function(d) { return [d.y, d.x]; }));\n\n  svg.selectAll(\".link path\")\n      .attr(\"class\", linkType)\n      .attr(\"d\", d3.svg.diagonal()\n        .source(function(d) { return {y: d.source.depth * step + (d.source.flipped ? -1 : +1) * d.source.width, x: d.source.x}; })\n        .target(function(d) { return {y: d.target.depth * step, x: d.target.x}; })\n        .projection(function(d) { return [d.y, d.x]; }));\n}\n\nfunction selectAllAnimation(startRoot, startHeight, endRoot, endHeight) {\n  var end = tree(endRoot, endHeight).remove(),\n      event = d3.dispatch(\"start\", \"middle\", \"end\", \"reset\"),\n      height = +end.attr(\"height\"),\n      start = tree(startRoot, startHeight).attr(\"height\", height),\n      svg = start.node(),\n      offset = (endHeight - startHeight) / 2,\n      transform = \"translate(\" + margin.left + \",\" + offset + \")\";\n\n  var play = start.append(\"g\")\n      .attr(\"class\", \"play\");\n\n  play.append(\"circle\")\n      .attr(\"r\", 45)\n      .attr(\"transform\", \"translate(\" + (margin.left + width / 2) + \",\" + height / 2 + \")\");\n\n  play.append(\"path\")\n      .attr(\"d\", \"M-22,-30l60,30l-60,30z\")\n      .attr(\"transform\", \"translate(\" + (margin.left + width / 2) + \",\" + height / 2 + \")scale(.7)\");\n\n  play.append(\"rect\")\n      .attr(\"width\", width)\n      .attr(\"height\", height)\n      .on(\"mousedown\", function() {\n        play.classed(\"mousedown\", true);\n        d3.select(window).on(\"mouseup\", function() { play.classed(\"mousedown\", false); });\n      })\n      .on(\"click\", function() {\n        resetAll();\n        animation();\n      });\n\n  end = d3.select(svg.appendChild(end.node().firstChild));\n  start = d3.select(svg.firstChild).attr(\"transform\", transform);\n  end.selectAll(\".array\").each(function() { this.parentNode.appendChild(this); }); // mask elements\n\n  var startNodes = start.datum().nodes,\n      startElements = startNodes.filter(function(d) { return d.type === \"element\"; }),\n      endNodes = end.datum().nodes,\n      endGroups = endNodes.filter(function(d) { return d.type === \"array\"; });\n\n  resetAll();\n\n  return event;\n\n  function resetAll() {\n    start.style(\"display\", \"none\").call(reset);\n    end.style(\"display\", null).call(reset);\n    play.style(\"display\", null);\n    event.reset();\n  }\n\n  function animation() {\n    start.call(fadeIn, 150);\n    end.style(\"display\", \"none\");\n    play.style(\"display\", \"none\");\n    setTimeout(transition1, 1250);\n    event.start();\n  }\n\n  function transition1() {\n    var t = start.transition()\n        .duration(1000 + (startElements.length - 1) * 50)\n        .each(\"end\", transition2);\n\n    t.selectAll(\".selection,.array,.link\")\n        .duration(0)\n        .style(\"stroke-opacity\", 0)\n        .style(\"fill-opacity\", 0);\n\n    t.selectAll(\".element\")\n        .duration(500)\n        .delay(function(d, i) { return 500 + i * 50; })\n        .attr(\"transform\", function(d, i) { return \"translate(\" + (d.depth - 1) * step + \",\" + (endGroups[i].x - offset) + \")\"; })\n        .attr(\"class\", \"array\")\n      .select(\"rect\")\n        .attr(\"width\", function(d, i) { return endGroups[i].width; });\n\n    event.middle();\n  }\n\n  function transition2() {\n    end.style(\"display\", null)\n      .selectAll(\".element,.to-element\")\n        .style(\"display\", \"none\");\n\n    end.selectAll(\".selection,.to-array,.array\")\n        .call(fadeIn);\n\n    end.transition()\n        .duration(500)\n        .each(\"end\", transition3);\n\n    event.end();\n  }\n\n  function transition3() {\n    start.style(\"display\", \"none\");\n\n    end.selectAll(\".element\")\n        .style(\"display\", null)\n        .attr(\"transform\", function(d) { return \"translate(\" + d.parent.depth * step + \",\" + d.parent.x + \")\"; })\n      .transition()\n        .duration(500)\n        .delay(function(d, i) { return i * 50; })\n        .attr(\"transform\", function(d) { return \"translate(\" + d.depth * step + \",\" + d.x + \")\"; });\n\n    end.selectAll(\".to-element\")\n        .style(\"display\", null)\n        .attr(\"d\", d3.svg.diagonal()\n          .source(function(d) { return {y: d.source.depth * step + d.source.width, x: d.source.x}; })\n          .target(function(d, i) { return {y: d.source.depth * step + d.source.width, x: d.source.x}; })\n          .projection(function(d) { return [d.y, d.x]; }))\n      .transition()\n        .duration(500)\n        .delay(function(d, i) { return i * 50; })\n        .attr(\"d\", d3.svg.diagonal()\n          .source(function(d) { return {y: d.source.depth * step + d.source.width, x: d.source.x}; })\n          .target(function(d, i) { return {y: d.target.depth * step, x: d.target.x}; })\n          .projection(function(d) { return [d.y, d.x]; }));\n\n    end.transition()\n        .duration(2000)\n        .each(\"end\", resetAll);\n  }\n}\n\nfunction updateAnimation(leftRoot, rightRoot, endRoot, outerHeight) {\n  var start = tree(leftRoot, rightRoot, outerHeight),\n      left = d3.select(start.node().firstChild),\n      right = d3.select(left.node().nextSibling),\n      end = tree(endRoot, outerHeight).remove(),\n      height = +start.attr(\"height\");\n\n  end = d3.select(start.node().appendChild(end.node().firstChild));\n  left.selectAll(\".element\").each(function() { this.parentNode.appendChild(this); }); // mask keys\n  right.selectAll(\".datum\").each(function() { this.parentNode.appendChild(this); }); // mask keys\n  start.node().appendChild(left.node());\n  start.node().appendChild(right.node());\n\n  var leftKeys = left.datum().nodes.filter(function(d) { return d.type === \"key\"; }),\n      rightKeys = right.datum().nodes.filter(function(d) { return d.type === \"key\"; }),\n      endElements = end.datum().nodes.filter(function(d) { return d.parent && d.parent.type === \"array\"; });\n\n  leftKeys.forEach(function(l, i) {\n    if (\"join\" in l) {\n      rightKeys[i + l.join].joined = true;\n      endElements[i + l.join].start = l.parent;\n      l.parent.end = endElements[i + l.join];\n    }\n  });\n\n  leftKeys.forEach(function(l, i) {\n    if (!(\"join\" in l)) endElements.some(function(e) {\n      if (!e.start) {\n        e.start = l.parent;\n        l.parent.end = e;\n        return true;\n      }\n    });\n  });\n\n  var play = start.append(\"g\")\n      .attr(\"class\", \"play\");\n\n  play.append(\"circle\")\n      .attr(\"r\", 45)\n      .attr(\"transform\", \"translate(\" + (margin.left + width / 2) + \",\" + height / 2 + \")\");\n\n  play.append(\"path\")\n      .attr(\"d\", \"M-22,-30l60,30l-60,30z\")\n      .attr(\"transform\", \"translate(\" + (margin.left + width / 2) + \",\" + height / 2 + \")scale(.7)\");\n\n  play.append(\"rect\")\n      .attr(\"width\", width)\n      .attr(\"height\", height)\n      .on(\"mousedown\", function() {\n        play.classed(\"mousedown\", true);\n        d3.select(window).on(\"mouseup\", function() { play.classed(\"mousedown\", false); });\n      })\n      .on(\"click\", function() {\n        resetAll();\n        animation();\n      });\n\n  resetAll();\n\n  function resetAll() {\n    play.style(\"display\", null);\n    left.style(\"display\", \"none\").call(reset);\n    right.style(\"display\", \"none\").call(reset);\n    right.selectAll(\".key\").classed(\"joined\", function(d) { return d.joined; });\n    right.selectAll(\".datum\").classed(\"joined\", function(d) { return d.children[0].joined; });\n    right.selectAll(\".to-key\").classed(\"joined\", function(d) { return d.target.joined; });\n    end.call(reset);\n  }\n\n  function animation() {\n    play.style(\"display\", \"none\");\n    end.style(\"display\", \"none\");\n    left.call(fadeIn);\n    right.call(fadeIn);\n    setTimeout(transition1, 1250);\n  }\n\n  function transition1() {\n    left.selectAll(\".key\").filter(function(d) { return !(\"join\" in d); })\n        .style(\"stroke-opacity\", 0)\n        .style(\"fill-opacity\", 0);\n\n    left.selectAll(\".to-key\").filter(function(d) { return !(\"join\" in d.target); })\n        .style(\"stroke-opacity\", 0)\n        .style(\"fill-opacity\", 0);\n\n    left.selectAll(\".element\").filter(function(d) { return !(\"join\" in d.children[0]); })\n        .style(\"stroke-opacity\", 0)\n        .style(\"fill-opacity\", 0);\n\n    left.selectAll(\".to-element\").filter(function(d) { return !(\"join\" in d.target.children[0]); })\n        .style(\"stroke-opacity\", 0)\n        .style(\"fill-opacity\", 0);\n\n    right.selectAll(\".link > :not(.joined),.node > :not(.joined)\")\n        .style(\"stroke-opacity\", 0)\n        .style(\"fill-opacity\", 0);\n\n    end.style(\"display\", null);\n\n    end.selectAll(\".datum,.to-datum\")\n        .style(\"display\", \"none\");\n\n    end.selectAll(\".element,.null\")\n        .attr(\"transform\", function(d, i) { return \"translate(\" + d.depth * step + \",\" + d.start.x + \")\"; });\n\n    end.selectAll(\".to-element,.to-null\")\n        .attr(\"d\", d3.svg.diagonal()\n          .source(function(d) { return {y: d.source.depth * step + d.source.width, x: d.source.x}; })\n          .target(function(d) { return {y: d.target.depth * step, x: d.target.start.x}; })\n          .projection(function(d) { return [d.y, d.x]; }));\n\n    setTimeout(transition2, 500);\n  }\n\n  function transition2() {\n    left.selectAll(\".element\").transition()\n        .duration(500)\n        .attr(\"transform\", function(d, i) { return \"translate(\" + d.depth * step + \",\" + d.end.x + \")\"; });\n\n    left.selectAll(\".key\").transition()\n        .duration(500)\n        .attr(\"transform\", function(d, i) { return \"translate(\" + d.depth * step + \",\" + d.parent.end.x + \")\"; });\n\n    left.selectAll(\".to-element\").transition()\n        .duration(500)\n        .attr(\"d\", d3.svg.diagonal()\n          .source(function(d) { return {y: d.source.depth * step + d.source.width, x: d.source.x}; })\n          .target(function(d) { return {y: d.target.depth * step, x: d.target.end.x}; })\n          .projection(function(d) { return [d.y, d.x]; }));\n\n    left.selectAll(\".to-key\").transition()\n        .duration(500)\n        .attr(\"d\", d3.svg.diagonal()\n          .source(function(d) { return {y: d.source.depth * step + d.source.width, x: d.source.end.x}; })\n          .target(function(d) { return {y: d.target.depth * step, x: d.target.parent.end.x}; })\n          .projection(function(d) { return [d.y, d.x]; }));\n\n    left.selectAll(\".join\").transition()\n        .duration(500)\n        .attr(\"d\", d3.svg.diagonal()\n          .source(function(d) { return {y: d.width, x: 0}; })\n          .target(function(d) { return {y: 88, x: 0}; })\n          .projection(function(d) { return [d.y, d.x]; }));\n\n    end.selectAll(\".element,.null\").transition()\n        .duration(500)\n        .attr(\"transform\", function(d, i) { return \"translate(\" + d.depth * step + \",\" + d.x + \")\"; });\n\n    end.selectAll(\".to-element,.to-null\").transition()\n        .duration(500)\n        .attr(\"d\", d3.svg.diagonal()\n          .source(function(d) { return {y: d.source.depth * step + d.source.width, x: d.source.x}; })\n          .target(function(d) { return {y: d.target.depth * step, x: d.target.x}; })\n          .projection(function(d) { return [d.y, d.x]; }));\n\n    setTimeout(transition3, 500);\n  }\n\n  function transition3() {\n    var offset = 12;\n\n    left.selectAll(\".join\").transition()\n        .duration(500)\n        .attr(\"d\", d3.svg.diagonal()\n          .source(function(d) { return {y: d.width, x: 0}; })\n          .target(function(d) { return {y: d.width, x: 0}; })\n          .projection(function(d) { return [d.y, d.x]; }));\n\n    left.selectAll(\".to-key\")\n        .attr(\"class\", \"from-element to-datum\");\n\n    right.selectAll(\".to-key\").transition()\n        .duration(500)\n        .attr(\"d\", d3.svg.diagonal()\n          .source(function(d) { return {y: (d.source.depth - 2) * step + offset - d.source.width, x: d.source.x}; })\n          .target(function(d) { return {y: (d.source.depth - 2) * step + offset - d.source.width, x: d.source.x}; })\n          .projection(function(d) { return [d.y, d.x]; }));\n\n    right.selectAll(\".key\").transition()\n        .duration(500)\n        .attr(\"transform\", function(d, i) { return \"translate(\" + ((d.depth - 1) * step + offset) + \",\" + d.x + \")\"; });\n\n    right.selectAll(\".datum\").transition()\n        .duration(500)\n        .attr(\"transform\", function(d, i) { return \"translate(\" + ((d.depth - 2) * step + offset) + \",\" + d.x + \")\"; });\n\n    setTimeout(resetAll, 2000);\n  }\n}\n\nfunction exitAnimation(leftRoot, rightRoot, endRoot, outerHeight) {\n  var start = tree(leftRoot, rightRoot, outerHeight),\n      left = d3.select(start.node().firstChild),\n      right = d3.select(left.node().nextSibling),\n      end = tree(endRoot, outerHeight).remove(),\n      height = +start.attr(\"height\");\n\n  end = d3.select(start.node().appendChild(end.node().firstChild));\n  start.node().appendChild(left.node());\n  start.node().appendChild(right.node());\n\n  var play = start.append(\"g\")\n      .attr(\"class\", \"play\");\n\n  play.append(\"circle\")\n      .attr(\"r\", 45)\n      .attr(\"transform\", \"translate(\" + (margin.left + width / 2) + \",\" + height / 2 + \")\");\n\n  play.append(\"path\")\n      .attr(\"d\", \"M-22,-30l60,30l-60,30z\")\n      .attr(\"transform\", \"translate(\" + (margin.left + width / 2) + \",\" + height / 2 + \")scale(.7)\");\n\n  play.append(\"rect\")\n      .attr(\"width\", width)\n      .attr(\"height\", height)\n      .on(\"mousedown\", function() {\n        play.classed(\"mousedown\", true);\n        d3.select(window).on(\"mouseup\", function() { play.classed(\"mousedown\", false); });\n      })\n      .on(\"click\", function() {\n        resetAll();\n        animation();\n      });\n\n  resetAll();\n\n  function resetAll() {\n    play.style(\"display\", null);\n    left.style(\"display\", \"none\").call(reset);\n    right.style(\"display\", \"none\").call(reset);\n    end.call(reset);\n  }\n\n  function animation() {\n    play.style(\"display\", \"none\");\n    end.style(\"display\", \"none\");\n    left.call(fadeIn);\n    right.call(fadeIn);\n    setTimeout(transition1, 1250);\n  }\n\n  function transition1() {\n    end.style(\"display\", null);\n\n    left\n        .style(\"stroke-opacity\", 0)\n        .style(\"fill-opacity\", 0);\n\n    right\n        .style(\"stroke-opacity\", 0)\n        .style(\"fill-opacity\", 0);\n\n    setTimeout(resetAll, 2000);\n  }\n}\n\nfunction enterAnimation(leftRoot, rightRoot, endRoot, outerHeight) {\n  var start = tree(leftRoot, rightRoot, outerHeight),\n      left = d3.select(start.node().firstChild),\n      right = d3.select(left.node().nextSibling),\n      end = tree(endRoot, outerHeight).remove(),\n      height = +start.attr(\"height\");\n\n  start.node().appendChild(left.node());\n  start.node().appendChild(right.node());\n  end = d3.select(start.node().appendChild(end.node().firstChild));\n\n  var leftKeys = left.datum().nodes.filter(function(d) { return d.type === \"key\"; }),\n      rightKeys = right.datum().nodes.filter(function(d) { return d.type === \"key\"; });\n\n  leftKeys.forEach(function(l, i) {\n    if (\"join\" in l) {\n      rightKeys[i + l.join].joined = true;\n    }\n  });\n\n  var play = start.append(\"g\")\n      .attr(\"class\", \"play\");\n\n  play.append(\"circle\")\n      .attr(\"r\", 45)\n      .attr(\"transform\", \"translate(\" + (margin.left + width / 2) + \",\" + height / 2 + \")\");\n\n  play.append(\"path\")\n      .attr(\"d\", \"M-22,-30l60,30l-60,30z\")\n      .attr(\"transform\", \"translate(\" + (margin.left + width / 2) + \",\" + height / 2 + \")scale(.7)\");\n\n  play.append(\"rect\")\n      .attr(\"width\", width)\n      .attr(\"height\", height)\n      .on(\"mousedown\", function() {\n        play.classed(\"mousedown\", true);\n        d3.select(window).on(\"mouseup\", function() { play.classed(\"mousedown\", false); });\n      })\n      .on(\"click\", function() {\n        resetAll();\n        animation();\n      });\n\n  resetAll();\n\n  function resetAll() {\n    play.style(\"display\", null);\n    left.style(\"display\", \"none\").call(reset);\n    right.style(\"display\", \"none\").call(reset);\n    right.selectAll(\".key\").classed(\"joined\", function(d) { return d.joined; });\n    right.selectAll(\".datum\").classed(\"joined\", function(d) { return d.children[0].joined; });\n    right.selectAll(\".to-key\").classed(\"joined\", function(d) { return d.target.joined; });\n    end.call(reset);\n  }\n\n  function animation() {\n    play.style(\"display\", \"none\");\n    end.style(\"display\", \"none\");\n    left.call(fadeIn);\n    right.call(fadeIn);\n    setTimeout(transition1, 1250);\n  }\n\n  function transition1() {\n    end.style(\"display\", null);\n\n    end.selectAll(\".element,.datum,.to-datum\")\n        .style(\"stroke-opacity\", 0)\n        .style(\"fill-opacity\", 0);\n\n    left.selectAll(\".element,.to-element,.key,.to-key\")\n        .style(\"stroke-opacity\", 0)\n        .style(\"fill-opacity\", 0);\n\n    right.selectAll(\".array,.to-array,.data,.to-function,.to-datum,.joined\")\n        .style(\"stroke-opacity\", 0)\n        .style(\"fill-opacity\", 0);\n\n    setTimeout(transition2, 750);\n  }\n\n  function transition2() {\n    var offset = 12;\n\n    right.selectAll(\".key:not(.joined)\").transition()\n        .duration(500)\n        .attr(\"transform\", function(d, i) { return \"translate(\" + ((d.depth - 2) * step + offset) + \",\" + d.x + \")\"; });\n\n    right.selectAll(\".datum:not(.joined)\").transition()\n        .duration(500)\n        .attr(\"transform\", function(d, i) { return \"translate(\" + ((d.depth - 2) * step + offset) + \",\" + d.x + \")\"; });\n\n    right.selectAll(\".to-key:not(.joined)\").transition()\n        .duration(500)\n        .attr(\"d\", d3.svg.diagonal()\n          .source(function(d) { return {y: (d.source.depth - 2) * step + offset - d.source.width, x: d.source.x}; })\n          .target(function(d) { return {y: (d.source.depth - 3) * step + offset - d.source.width, x: d.source.x}; })\n          .projection(function(d) { return [d.y, d.x]; }));\n\n    setTimeout(transition3, 500);\n  }\n\n  function transition3() {\n    right.selectAll(\".to-key:not(.joined)\")\n        .style(\"stroke-opacity\", 0);\n\n    end.selectAll(\".element,.datum,.to-datum\")\n        .style(\"stroke-opacity\", 1)\n        .style(\"fill-opacity\", 1);\n\n    setTimeout(resetAll, 2000);\n  }\n}\n\nfunction fadeIn(selection, delay) {\n  selection\n      .style(\"display\", null)\n      .style(\"stroke-opacity\", 0)\n      .style(\"fill-opacity\", 0)\n    .transition()\n      .duration(delay || 0)\n      .style(\"stroke-opacity\", 1)\n      .style(\"fill-opacity\", 1);\n}\n\n</script>\n\n<aside><a href=\"http://ja.d3js.info/mike/selection/\">日本語</a></aside>\n\n<p>In the past I have <a href=\"../d3/workshop/\">presented</a> <a href=\"../join/\">simplified</a> <a href=\"http://mbostock.github.io/d3/tutorial/circle.html\">descriptions</a> of <a href=\"http://d3js.org\">D3</a>’s selections, providing only enough detail to get started. This article takes a more comprehensive approach; rather than saying how to <i>use</i> <a href=\"https://github.com/mbostock/d3/wiki/Selections\">selections</a>, I will explain how selections are <i>implemented</i>. This may take longer to read, but it should dispel any magic and help you master data-driven documents.\n\n</p><p>The structure of this article may at first seem arbitrary. It describes the internal workings of selections rather than the design motivations, so you may wonder why such mechanisms are needed. This is simply because it is easier to lay all the pieces out first before explaining how everything works in tandem. By the time you read to the end, the intent of the design as well as its function should be clear.\n\n</p><p>D3 is a visualization library, so this article incorporates visual explanations to accompany the text. In subsequent diagrams, the left side of the diagram will show the structure of selections, while the right side will show the structure of data:\n\n</p><p><svg width=\"740\" height=\"120\" style=\"margin:1em -10px;\">\n  <g transform=\"translate(9.5,9.5)\">\n    <rect fill=\"#eee\" stroke=\"#ccc\" stroke-dasharray=\"2,2\" width=\"355\" height=\"100\"></rect>\n    <rect fill=\"#eee\" stroke=\"#ccc\" stroke-dasharray=\"2,2\" x=\"365\" width=\"355\" height=\"100\"></rect>\n    <rect fill=\"#a1d99b\" fill-opacity=\".8\" stroke=\"#71a76c\" stroke-dasharray=\"2,2\" y=\"10\" x=\"300\" width=\"120\" height=\"80\"></rect>\n    <text x=\"178\" text-anchor=\"middle\" y=\"50\" dy=\".35em\">selections will go here</text>\n    <text x=\"360\" text-anchor=\"middle\" y=\"50\" dy=\".35em\">joiny bits will go here</text>\n    <text x=\"543\" text-anchor=\"middle\" y=\"50\" dy=\".35em\">data will go here</text>\n  </g>\n</svg>\n\n</p><p>Rounded rectangles such as <span style=\"display:inline-block;position:relative;width:55px;\"><svg style=\"position:absolute;top:-17px;\" class=\"node\" width=\"55\" height=\"22\"><g transform=\"translate(1,1)\" class=\"datum\"><rect rx=\"6\" ry=\"6\" width=\"53\" height=\"20\"></rect><text x=\"26\" y=\"10\" dy=\".35em\" text-anchor=\"middle\">thing</text></g></svg></span> indicate JavaScript objects of various types, ranging from literal objects (<code class=\"javascript\">{foo: <span class=\"number\">16</span>}</code>), primitive values (<code class=\"javascript\"><span class=\"string\">\"hello\"</span></code>), arrays of numbers (<code class=\"javascript\">[<span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">3</span>]</code>) to DOM elements. Certain special object types are colored, including <span style=\"display:inline-block;position:relative;width:55px;\"><svg style=\"position:absolute;top:-17px;\" class=\"node\" width=\"55\" height=\"22\"><g transform=\"translate(1,1)\" class=\"selection\"><rect rx=\"6\" ry=\"6\" width=\"53\" height=\"20\"></rect><text x=\"26\" y=\"10\" dy=\".35em\" text-anchor=\"middle\">selection</text></g></svg></span>, <span style=\"display:inline-block;position:relative;width:55px;\"><svg style=\"position:absolute;top:-17px;\" class=\"node\" width=\"55\" height=\"22\"><g transform=\"translate(1,1)\" class=\"array\"><rect rx=\"6\" ry=\"6\" width=\"53\" height=\"20\"></rect><text x=\"26\" y=\"10\" dy=\".35em\" text-anchor=\"middle\">array</text></g></svg></span>, and <span style=\"display:inline-block;position:relative;width:55px;\"><svg style=\"position:absolute;top:-17px;\" class=\"node\" width=\"55\" height=\"22\"><g transform=\"translate(1,1)\" class=\"element\"><rect rx=\"6\" ry=\"6\" width=\"53\" height=\"20\"></rect><text x=\"26\" y=\"10\" dy=\".35em\" text-anchor=\"middle\">element</text></g></svg></span>. References from one object to another are indicated with connecting lines (<span style=\"display:inline-block;position:relative;width:55px;\"><svg style=\"position:absolute;top:-17px;\" class=\"link\" width=\"55\" height=\"22\"><line x1=\"1\" x2=\"54\" y1=\"11\" y2=\"11\"></line></svg></span>). For example, an array containing the number 42 looks like:\n\n</p><pre><code class=\"javascript\"><span class=\"keyword\">var</span> array = [<span class=\"number\">42</span>];</code></pre>\n\n<script>\n\ntree(\n  {type: \"array\", name: \"array\", children: [\n    {type: \"datum\", name: \"42\"}\n  ]},\n  24 * 1\n);\n\n</script><svg width=\"800\" height=\"24\" style=\"margin: 1em 0px 1em -40px;\"><g class=\"left\" transform=\"translate(40,0)\"><g class=\"link\"><path class=\"to-datum from-array\" d=\"M42,12C71,12 71,12 100,12\"></path></g><g class=\"node\"><g class=\"array\" transform=\"translate(0,12)\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"42\"></rect><text dy=\".35em\" x=\"6\">array</text></g><g class=\"datum\" transform=\"translate(100,12)\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"32\"></rect><text dy=\".35em\" x=\"6\">42</text></g></g></g></svg>\n\n<p>Wherever possible, the code that generates the given selection appears immediately above the diagram. Opening your browser’s JavaScript console and creating selections interactively is a great way to test your understanding of the text!\n\n</p><p>Let’s begin.\n\n</p><h2><a href=\"#subclass\" name=\"subclass\">#</a>A Subclass of Array</h2>\n\n<aside>JavaScript doesn’t yet support array subclasses directly, so arrays are subclassed through <a href=\"http://perfectionkills.com/how-ecmascript-5-still-does-not-allow-to-subclass-an-array/\">prototype chain injection</a>.</aside>\n\n<p>You were probably told that selections are arrays of DOM elements. False. For one, selections are a <i>subclass</i> of array; this subclass provides methods to manipulate selected elements, such as setting <a href=\"https://github.com/mbostock/d3/wiki/Selections#wiki-attr\">attributes</a> and <a href=\"https://github.com/mbostock/d3/wiki/Selections#wiki-style\">styles</a>. Selections inherit native array methods as well, such as <a href=\"https://developer.mozilla.org/en-US/docs/JavaScript/Reference/Global_Objects/Array/forEach\">array.forEach</a> and <a href=\"https://developer.mozilla.org/en-US/docs/JavaScript/Reference/Global_Objects/Array/forEach\">array.map</a>. However, you won’t often use native methods as D3 provides convenient alternatives, such as <a href=\"https://github.com/mbostock/d3/wiki/Selections#wiki-each\">selection.each</a>. (A few native methods are overridden to adapt their behavior to selections, namely <a href=\"https://github.com/mbostock/d3/wiki/Selections#wiki-filter\">selection.filter</a> and <a href=\"https://github.com/mbostock/d3/wiki/Selections#wiki-sort\">selection.sort</a>.)\n\n</p><h2><a href=\"#group\" name=\"group\">#</a>Grouping Elements</h2>\n\n<p>Another reason selections aren’t literally arrays of elements is that they are <i>arrays of arrays</i> of elements: a selection is an array of groups, and each group is an array of elements. For example, <a href=\"https://github.com/mbostock/d3/wiki/Selections#wiki-d3_select\">d3.select</a> returns a selection with one group containing the selected element:\n\n</p><pre><code class=\"javascript\"><span class=\"keyword\">var</span> selection = d3.select(<span class=\"string\">\"body\"</span>);</code></pre>\n\n<script>\n\ntree(\n  {type: \"selection\", name: \"selection\", children: [\n    {type: \"array\", name: \"group\", children: [\n      {type: \"element\", name: \"body\"}\n    ]}\n  ]},\n  24 * 1\n);\n\n</script><svg width=\"800\" height=\"24\" style=\"margin: 1em 0px 1em -40px;\"><g class=\"left\" transform=\"translate(40,0)\"><g class=\"link\"><path class=\"to-array from-selection\" d=\"M66,12C83,12 83,12 100,12\"></path><path class=\"to-element from-array\" d=\"M142,12C171,12 171,12 200,12\"></path></g><g class=\"node\"><g class=\"selection\" transform=\"translate(0,12)\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"66\"></rect><text dy=\".35em\" x=\"6\">selection</text></g><g class=\"array\" transform=\"translate(100,12)\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"42\"></rect><text dy=\".35em\" x=\"6\">group</text></g><g class=\"element\" transform=\"translate(200,12)\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"36\"></rect><text dy=\".35em\" x=\"6\">body</text></g></g></g></svg>\n\n<aside>In Chrome, you can open the console with the keyboard shortcut <span style=\"font-family:'Lucida Grande';\">⌥⌘J</span>.</aside>\n\n<p>In the <a href=\"https://developers.google.com/chrome-developer-tools/docs/console#opening_the_console\">JavaScript console</a>, try running this command and inspecting the group as <code class=\"javascript\">selection[<span class=\"number\">0</span>]</code> and the node as <code class=\"javascript\">selection[<span class=\"number\">0</span>][<span class=\"number\">0</span>]</code>. While accessing a node directly is supported by D3’s API, for reasons that will soon be apparent it is more common to use <a href=\"https://github.com/mbostock/d3/wiki/Selections#wiki-node\">selection.node</a>.\n\n</p><p>Likewise, <a href=\"https://github.com/mbostock/d3/wiki/Selections#wiki-d3_selectAll\">d3.selectAll</a> returns a selection with one group and any number of elements:\n\n</p><pre><code class=\"javascript\">d3.selectAll(<span class=\"string\">\"h2\"</span>);</code></pre>\n\n<aside>While the selection is a subclass of array, groups are plain arrays.</aside>\n\n<script>\n\ntree(\n  {type: \"selection\", name: \"selection\", children: [\n    {type: \"array\", name: \"group\", children: [\n      {type: \"element\", name: \"h2\"},\n      {type: \"element\", name: \"h2\"},\n      {type: \"element\", name: \"h2\"},\n      {type: \"element\", name: \"h2\"}\n    ]}\n  ]},\n  24 * 4\n);\n\n</script><svg width=\"800\" height=\"96\" style=\"margin: 1em 0px 1em -40px;\"><g class=\"left\" transform=\"translate(40,0)\"><g class=\"link\"><path class=\"to-array from-selection\" d=\"M66,48C83,48 83,48 100,48\"></path><path class=\"to-element from-array\" d=\"M142,48C171,48 171,12 200,12\"></path><path class=\"to-element from-array\" d=\"M142,48C171,48 171,36 200,36\"></path><path class=\"to-element from-array\" d=\"M142,48C171,48 171,60 200,60\"></path><path class=\"to-element from-array\" d=\"M142,48C171,48 171,84 200,84\"></path></g><g class=\"node\"><g class=\"selection\" transform=\"translate(0,48)\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"66\"></rect><text dy=\".35em\" x=\"6\">selection</text></g><g class=\"array\" transform=\"translate(100,48)\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"42\"></rect><text dy=\".35em\" x=\"6\">group</text></g><g class=\"element\" transform=\"translate(200,12)\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"32\"></rect><text dy=\".35em\" x=\"6\">h2</text></g><g class=\"element\" transform=\"translate(200,36)\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"32\"></rect><text dy=\".35em\" x=\"6\">h2</text></g><g class=\"element\" transform=\"translate(200,60)\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"32\"></rect><text dy=\".35em\" x=\"6\">h2</text></g><g class=\"element\" transform=\"translate(200,84)\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"32\"></rect><text dy=\".35em\" x=\"6\">h2</text></g></g></g></svg>\n\n<p>Selections returned by d3.select and d3.selectAll have exactly one group. The only way for you to obtain a selection with multiple groups is <a href=\"https://github.com/mbostock/d3/wiki/Selections#wiki-selectAll\">selection.selectAll</a>. For example, if you select all table rows and then select the rows’ cells, you’ll get a group of sibling cells for each row:\n\n</p><pre><code class=\"javascript\">d3.<span id=\"select-all-1-1\" style=\"\">selectAll(<span class=\"string\">\"tr\"</span>)</span>.<span id=\"select-all-1-2\">selectAll(<span class=\"string\">\"td\"</span>)</span>;</code></pre>\n\n<aside>Although this selection’s groups all have four elements, in general a selection’s groups can have different numbers of elements. Some groups might even be empty!</aside>\n\n<script>\n\nselectAllAnimation(\n  {type: \"selection\", name: \"selection\", children: [\n    {type: \"array\", name: \"group\", children: [\n      {type: \"element\", name: \"tr\"},\n      {type: \"element\", name: \"tr\"},\n      {type: \"element\", name: \"tr\"},\n      {type: \"element\", name: \"tr\"}\n    ]}\n  ]},\n  24 * 4,\n  {type: \"selection\", name: \"selection\", children: [\n    {type: \"array\", name: \"group\", children: [\n      {type: \"element\", name: \"td\"},\n      {type: \"element\", name: \"td\"},\n      {type: \"element\", name: \"td\"},\n      {type: \"element\", name: \"td\"}\n    ]},\n    {type: \"array\", name: \"group\", children: [\n      {type: \"element\", name: \"td\"},\n      {type: \"element\", name: \"td\"},\n      {type: \"element\", name: \"td\"},\n      {type: \"element\", name: \"td\"}\n    ]},\n    {type: \"array\", name: \"group\", children: [\n      {type: \"element\", name: \"td\"},\n      {type: \"element\", name: \"td\"},\n      {type: \"element\", name: \"td\"},\n      {type: \"element\", name: \"td\"}\n    ]},\n    {type: \"array\", name: \"group\", children: [\n      {type: \"element\", name: \"td\"},\n      {type: \"element\", name: \"td\"},\n      {type: \"element\", name: \"td\"},\n      {type: \"element\", name: \"td\"}\n    ]}\n  ]},\n  24 * 16\n).on(\"start\", function() {\n  d3.select(\"#select-all-1-1\").style(\"background\", \"#ff0\");\n}).on(\"middle\", function() {\n  d3.select(\"#select-all-1-1\").style(\"background\", null);\n}).on(\"end\", function() {\n  d3.select(\"#select-all-1-2\").style(\"background\", \"#ff0\");\n}).on(\"reset\", function() {\n  d3.selectAll(\"#select-all-1-1,#select-all-1-2\").style(\"background\", null);\n});\n\n</script><svg width=\"800\" height=\"384\" style=\"margin: 1em 0px 1em -40px;\"><g class=\"left\" transform=\"translate(40,144)\" style=\"stroke-opacity: 1; fill-opacity: 1; display: none;\"><g class=\"link\" style=\"\"><path class=\"to-array from-selection\" d=\"M66,48C83,48 83,48 100,48\"></path><path class=\"to-element from-array\" d=\"M142,48C171,48 171,12 200,12\"></path><path class=\"to-element from-array\" d=\"M142,48C171,48 171,36 200,36\"></path><path class=\"to-element from-array\" d=\"M142,48C171,48 171,60 200,60\"></path><path class=\"to-element from-array\" d=\"M142,48C171,48 171,84 200,84\"></path></g><g class=\"node\"><g class=\"selection\" transform=\"translate(0,48)\" style=\"\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"66\"></rect><text dy=\".35em\" x=\"6\">selection</text></g><g class=\"array\" transform=\"translate(100,48)\" style=\"\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"42\"></rect><text dy=\".35em\" x=\"6\">group</text></g><g class=\"element\" transform=\"translate(200,12)\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"32\"></rect><text dy=\".35em\" x=\"6\">tr</text></g><g class=\"element\" transform=\"translate(200,36)\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"32\"></rect><text dy=\".35em\" x=\"6\">tr</text></g><g class=\"element\" transform=\"translate(200,60)\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"32\"></rect><text dy=\".35em\" x=\"6\">tr</text></g><g class=\"element\" transform=\"translate(200,84)\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"32\"></rect><text dy=\".35em\" x=\"6\">tr</text></g></g></g><g class=\"play\"><circle r=\"45\" transform=\"translate(400,192)\"></circle><path d=\"M-22,-30l60,30l-60,30z\" transform=\"translate(400,192)scale(.7)\"></path><rect width=\"720\" height=\"384\"></rect></g><g class=\"left\" transform=\"translate(40,0)\" style=\"\"><g class=\"link\"><path class=\"to-array from-selection\" d=\"M66,192C83,192 83,48 100,48\" style=\"\"></path><path class=\"to-array from-selection\" d=\"M66,192C83,192 83,144 100,144\" style=\"\"></path><path class=\"to-array from-selection\" d=\"M66,192C83,192 83,240 100,240\" style=\"\"></path><path class=\"to-array from-selection\" d=\"M66,192C83,192 83,336 100,336\" style=\"\"></path><path class=\"to-element from-array\" d=\"M142,48C171,48 171,12 200,12\" style=\"\"></path><path class=\"to-element from-array\" d=\"M142,48C171,48 171,36 200,36\" style=\"\"></path><path class=\"to-element from-array\" d=\"M142,48C171,48 171,60 200,60\" style=\"\"></path><path class=\"to-element from-array\" d=\"M142,48C171,48 171,84 200,84\" style=\"\"></path><path class=\"to-element from-array\" d=\"M142,144C171,144 171,108 200,108\" style=\"\"></path><path class=\"to-element from-array\" d=\"M142,144C171,144 171,132 200,132\" style=\"\"></path><path class=\"to-element from-array\" d=\"M142,144C171,144 171,156 200,156\" style=\"\"></path><path class=\"to-element from-array\" d=\"M142,144C171,144 171,180 200,180\" style=\"\"></path><path class=\"to-element from-array\" d=\"M142,240C171,240 171,204 200,204\" style=\"\"></path><path class=\"to-element from-array\" d=\"M142,240C171,240 171,228 200,228\" style=\"\"></path><path class=\"to-element from-array\" d=\"M142,240C171,240 171,252 200,252\" style=\"\"></path><path class=\"to-element from-array\" d=\"M142,240C171,240 171,276 200,276\" style=\"\"></path><path class=\"to-element from-array\" d=\"M142,336C171,336 171,300 200,300\" style=\"\"></path><path class=\"to-element from-array\" d=\"M142,336C171,336 171,324 200,324\" style=\"\"></path><path class=\"to-element from-array\" d=\"M142,336C171,336 171,348 200,348\" style=\"\"></path><path class=\"to-element from-array\" d=\"M142,336C171,336 171,372 200,372\" style=\"\"></path></g><g class=\"node\"><g class=\"selection\" transform=\"translate(0,192)\" style=\"\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"66\"></rect><text dy=\".35em\" x=\"6\">selection</text></g><g class=\"element\" transform=\"translate(200,12)\" style=\"\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"32\"></rect><text dy=\".35em\" x=\"6\">td</text></g><g class=\"element\" transform=\"translate(200,36)\" style=\"\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"32\"></rect><text dy=\".35em\" x=\"6\">td</text></g><g class=\"element\" transform=\"translate(200,60)\" style=\"\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"32\"></rect><text dy=\".35em\" x=\"6\">td</text></g><g class=\"element\" transform=\"translate(200,84)\" style=\"\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"32\"></rect><text dy=\".35em\" x=\"6\">td</text></g><g class=\"element\" transform=\"translate(200,108)\" style=\"\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"32\"></rect><text dy=\".35em\" x=\"6\">td</text></g><g class=\"element\" transform=\"translate(200,132)\" style=\"\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"32\"></rect><text dy=\".35em\" x=\"6\">td</text></g><g class=\"element\" transform=\"translate(200,156)\" style=\"\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"32\"></rect><text dy=\".35em\" x=\"6\">td</text></g><g class=\"element\" transform=\"translate(200,180)\" style=\"\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"32\"></rect><text dy=\".35em\" x=\"6\">td</text></g><g class=\"element\" transform=\"translate(200,204)\" style=\"\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"32\"></rect><text dy=\".35em\" x=\"6\">td</text></g><g class=\"element\" transform=\"translate(200,228)\" style=\"\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"32\"></rect><text dy=\".35em\" x=\"6\">td</text></g><g class=\"element\" transform=\"translate(200,252)\" style=\"\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"32\"></rect><text dy=\".35em\" x=\"6\">td</text></g><g class=\"element\" transform=\"translate(200,276)\" style=\"\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"32\"></rect><text dy=\".35em\" x=\"6\">td</text></g><g class=\"element\" transform=\"translate(200,300)\" style=\"\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"32\"></rect><text dy=\".35em\" x=\"6\">td</text></g><g class=\"element\" transform=\"translate(200,324)\" style=\"\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"32\"></rect><text dy=\".35em\" x=\"6\">td</text></g><g class=\"element\" transform=\"translate(200,348)\" style=\"\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"32\"></rect><text dy=\".35em\" x=\"6\">td</text></g><g class=\"element\" transform=\"translate(200,372)\" style=\"\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"32\"></rect><text dy=\".35em\" x=\"6\">td</text></g><g class=\"array\" transform=\"translate(100,48)\" style=\"\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"42\"></rect><text dy=\".35em\" x=\"6\">group</text></g><g class=\"array\" transform=\"translate(100,144)\" style=\"\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"42\"></rect><text dy=\".35em\" x=\"6\">group</text></g><g class=\"array\" transform=\"translate(100,240)\" style=\"\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"42\"></rect><text dy=\".35em\" x=\"6\">group</text></g><g class=\"array\" transform=\"translate(100,336)\" style=\"\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"42\"></rect><text dy=\".35em\" x=\"6\">group</text></g></g></g></svg>\n\n<p>With selectAll, <b>every element in the old selection becomes a group in the new selection</b>; each group contains an old element’s matching descendant elements. So, if each table cell contained a <a href=\"https://developer.mozilla.org/en-US/docs/HTML/Element/span\">span</a> element, and you called selectAll a third time, you’d get a selection with sixteen groups:\n\n</p><pre><code class=\"javascript\">d3.selectAll(<span class=\"string\">\"tr\"</span>).<span id=\"select-all-2-1\" style=\"\">selectAll(<span class=\"string\">\"td\"</span>)</span>.<span id=\"select-all-2-2\">selectAll(<span class=\"string\">\"span\"</span>)</span>;</code></pre>\n\n<script>\n\nselectAllAnimation(\n  {type: \"selection\", name: \"selection\", children: [\n    {type: \"array\", name: \"group\", children: [\n      {type: \"element\", name: \"td\"},\n      {type: \"element\", name: \"td\"},\n      {type: \"element\", name: \"td\"},\n      {type: \"element\", name: \"td\"}\n    ]},\n    {type: \"array\", name: \"group\", children: [\n      {type: \"element\", name: \"td\"},\n      {type: \"element\", name: \"td\"},\n      {type: \"element\", name: \"td\"},\n      {type: \"element\", name: \"td\"}\n    ]},\n    {type: \"array\", name: \"group\", children: [\n      {type: \"element\", name: \"td\"},\n      {type: \"element\", name: \"td\"},\n      {type: \"element\", name: \"td\"},\n      {type: \"element\", name: \"td\"}\n    ]},\n    {type: \"array\", name: \"group\", children: [\n      {type: \"element\", name: \"td\"},\n      {type: \"element\", name: \"td\"},\n      {type: \"element\", name: \"td\"},\n      {type: \"element\", name: \"td\"}\n    ]}\n  ]},\n  24 * 16,\n  {type: \"selection\", name: \"selection\", children: [\n    {type: \"array\", name: \"group\", children: [{type: \"element\", name: \"span\"}]},\n    {type: \"array\", name: \"group\", children: [{type: \"element\", name: \"span\"}]},\n    {type: \"array\", name: \"group\", children: [{type: \"element\", name: \"span\"}]},\n    {type: \"array\", name: \"group\", children: [{type: \"element\", name: \"span\"}]},\n    {type: \"array\", name: \"group\", children: [{type: \"element\", name: \"span\"}]},\n    {type: \"array\", name: \"group\", children: [{type: \"element\", name: \"span\"}]},\n    {type: \"array\", name: \"group\", children: [{type: \"element\", name: \"span\"}]},\n    {type: \"array\", name: \"group\", children: [{type: \"element\", name: \"span\"}]},\n    {type: \"array\", name: \"group\", children: [{type: \"element\", name: \"span\"}]},\n    {type: \"array\", name: \"group\", children: [{type: \"element\", name: \"span\"}]},\n    {type: \"array\", name: \"group\", children: [{type: \"element\", name: \"span\"}]},\n    {type: \"array\", name: \"group\", children: [{type: \"element\", name: \"span\"}]},\n    {type: \"array\", name: \"group\", children: [{type: \"element\", name: \"span\"}]},\n    {type: \"array\", name: \"group\", children: [{type: \"element\", name: \"span\"}]},\n    {type: \"array\", name: \"group\", children: [{type: \"element\", name: \"span\"}]},\n    {type: \"array\", name: \"group\", children: [{type: \"element\", name: \"span\"}]}\n  ]},\n  24 * 16\n).on(\"start\", function() {\n  d3.select(\"#select-all-2-1\").style(\"background\", \"#ff0\");\n}).on(\"middle\", function() {\n  d3.select(\"#select-all-2-1\").style(\"background\", null);\n}).on(\"end\", function() {\n  d3.select(\"#select-all-2-2\").style(\"background\", \"#ff0\");\n}).on(\"reset\", function() {\n  d3.selectAll(\"#select-all-2-1,#select-all-2-2\").style(\"background\", null);\n});\n\n</script><svg width=\"800\" height=\"384\" style=\"margin: 1em 0px 1em -40px;\"><g class=\"left\" transform=\"translate(40,0)\" style=\"stroke-opacity: 1; fill-opacity: 1; display: none;\"><g class=\"link\" style=\"\"><path class=\"to-array from-selection\" d=\"M66,192C83,192 83,48 100,48\"></path><path class=\"to-array from-selection\" d=\"M66,192C83,192 83,144 100,144\"></path><path class=\"to-array from-selection\" d=\"M66,192C83,192 83,240 100,240\"></path><path class=\"to-array from-selection\" d=\"M66,192C83,192 83,336 100,336\"></path><path class=\"to-element from-array\" d=\"M142,48C171,48 171,12 200,12\"></path><path class=\"to-element from-array\" d=\"M142,48C171,48 171,36 200,36\"></path><path class=\"to-element from-array\" d=\"M142,48C171,48 171,60 200,60\"></path><path class=\"to-element from-array\" d=\"M142,48C171,48 171,84 200,84\"></path><path class=\"to-element from-array\" d=\"M142,144C171,144 171,108 200,108\"></path><path class=\"to-element from-array\" d=\"M142,144C171,144 171,132 200,132\"></path><path class=\"to-element from-array\" d=\"M142,144C171,144 171,156 200,156\"></path><path class=\"to-element from-array\" d=\"M142,144C171,144 171,180 200,180\"></path><path class=\"to-element from-array\" d=\"M142,240C171,240 171,204 200,204\"></path><path class=\"to-element from-array\" d=\"M142,240C171,240 171,228 200,228\"></path><path class=\"to-element from-array\" d=\"M142,240C171,240 171,252 200,252\"></path><path class=\"to-element from-array\" d=\"M142,240C171,240 171,276 200,276\"></path><path class=\"to-element from-array\" d=\"M142,336C171,336 171,300 200,300\"></path><path class=\"to-element from-array\" d=\"M142,336C171,336 171,324 200,324\"></path><path class=\"to-element from-array\" d=\"M142,336C171,336 171,348 200,348\"></path><path class=\"to-element from-array\" d=\"M142,336C171,336 171,372 200,372\"></path></g><g class=\"node\"><g class=\"selection\" transform=\"translate(0,192)\" style=\"\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"66\"></rect><text dy=\".35em\" x=\"6\">selection</text></g><g class=\"array\" transform=\"translate(100,48)\" style=\"\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"42\"></rect><text dy=\".35em\" x=\"6\">group</text></g><g class=\"element\" transform=\"translate(200,12)\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"32\"></rect><text dy=\".35em\" x=\"6\">td</text></g><g class=\"element\" transform=\"translate(200,36)\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"32\"></rect><text dy=\".35em\" x=\"6\">td</text></g><g class=\"element\" transform=\"translate(200,60)\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"32\"></rect><text dy=\".35em\" x=\"6\">td</text></g><g class=\"element\" transform=\"translate(200,84)\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"32\"></rect><text dy=\".35em\" x=\"6\">td</text></g><g class=\"array\" transform=\"translate(100,144)\" style=\"\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"42\"></rect><text dy=\".35em\" x=\"6\">group</text></g><g class=\"element\" transform=\"translate(200,108)\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"32\"></rect><text dy=\".35em\" x=\"6\">td</text></g><g class=\"element\" transform=\"translate(200,132)\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"32\"></rect><text dy=\".35em\" x=\"6\">td</text></g><g class=\"element\" transform=\"translate(200,156)\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"32\"></rect><text dy=\".35em\" x=\"6\">td</text></g><g class=\"element\" transform=\"translate(200,180)\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"32\"></rect><text dy=\".35em\" x=\"6\">td</text></g><g class=\"array\" transform=\"translate(100,240)\" style=\"\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"42\"></rect><text dy=\".35em\" x=\"6\">group</text></g><g class=\"element\" transform=\"translate(200,204)\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"32\"></rect><text dy=\".35em\" x=\"6\">td</text></g><g class=\"element\" transform=\"translate(200,228)\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"32\"></rect><text dy=\".35em\" x=\"6\">td</text></g><g class=\"element\" transform=\"translate(200,252)\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"32\"></rect><text dy=\".35em\" x=\"6\">td</text></g><g class=\"element\" transform=\"translate(200,276)\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"32\"></rect><text dy=\".35em\" x=\"6\">td</text></g><g class=\"array\" transform=\"translate(100,336)\" style=\"\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"42\"></rect><text dy=\".35em\" x=\"6\">group</text></g><g class=\"element\" transform=\"translate(200,300)\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"32\"></rect><text dy=\".35em\" x=\"6\">td</text></g><g class=\"element\" transform=\"translate(200,324)\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"32\"></rect><text dy=\".35em\" x=\"6\">td</text></g><g class=\"element\" transform=\"translate(200,348)\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"32\"></rect><text dy=\".35em\" x=\"6\">td</text></g><g class=\"element\" transform=\"translate(200,372)\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"32\"></rect><text dy=\".35em\" x=\"6\">td</text></g></g></g><g class=\"play\"><circle r=\"45\" transform=\"translate(400,192)\"></circle><path d=\"M-22,-30l60,30l-60,30z\" transform=\"translate(400,192)scale(.7)\"></path><rect width=\"720\" height=\"384\"></rect></g><g class=\"left\" transform=\"translate(40,0)\" style=\"\"><g class=\"link\"><path class=\"to-array from-selection\" d=\"M66,192C83,192 83,12 100,12\" style=\"\"></path><path class=\"to-array from-selection\" d=\"M66,192C83,192 83,36 100,36\" style=\"\"></path><path class=\"to-array from-selection\" d=\"M66,192C83,192 83,60 100,60\" style=\"\"></path><path class=\"to-array from-selection\" d=\"M66,192C83,192 83,84 100,84\" style=\"\"></path><path class=\"to-array from-selection\" d=\"M66,192C83,192 83,108 100,108\" style=\"\"></path><path class=\"to-array from-selection\" d=\"M66,192C83,192 83,132 100,132\" style=\"\"></path><path class=\"to-array from-selection\" d=\"M66,192C83,192 83,156 100,156\" style=\"\"></path><path class=\"to-array from-selection\" d=\"M66,192C83,192 83,180 100,180\" style=\"\"></path><path class=\"to-array from-selection\" d=\"M66,192C83,192 83,204 100,204\" style=\"\"></path><path class=\"to-array from-selection\" d=\"M66,192C83,192 83,228 100,228\" style=\"\"></path><path class=\"to-array from-selection\" d=\"M66,192C83,192 83,252 100,252\" style=\"\"></path><path class=\"to-array from-selection\" d=\"M66,192C83,192 83,276 100,276\" style=\"\"></path><path class=\"to-array from-selection\" d=\"M66,192C83,192 83,300 100,300\" style=\"\"></path><path class=\"to-array from-selection\" d=\"M66,192C83,192 83,324 100,324\" style=\"\"></path><path class=\"to-array from-selection\" d=\"M66,192C83,192 83,348 100,348\" style=\"\"></path><path class=\"to-array from-selection\" d=\"M66,192C83,192 83,372 100,372\" style=\"\"></path><path class=\"to-element from-array\" d=\"M142,12C171,12 171,12 200,12\" style=\"\"></path><path class=\"to-element from-array\" d=\"M142,36C171,36 171,36 200,36\" style=\"\"></path><path class=\"to-element from-array\" d=\"M142,60C171,60 171,60 200,60\" style=\"\"></path><path class=\"to-element from-array\" d=\"M142,84C171,84 171,84 200,84\" style=\"\"></path><path class=\"to-element from-array\" d=\"M142,108C171,108 171,108 200,108\" style=\"\"></path><path class=\"to-element from-array\" d=\"M142,132C171,132 171,132 200,132\" style=\"\"></path><path class=\"to-element from-array\" d=\"M142,156C171,156 171,156 200,156\" style=\"\"></path><path class=\"to-element from-array\" d=\"M142,180C171,180 171,180 200,180\" style=\"\"></path><path class=\"to-element from-array\" d=\"M142,204C171,204 171,204 200,204\" style=\"\"></path><path class=\"to-element from-array\" d=\"M142,228C171,228 171,228 200,228\" style=\"\"></path><path class=\"to-element from-array\" d=\"M142,252C171,252 171,252 200,252\" style=\"\"></path><path class=\"to-element from-array\" d=\"M142,276C171,276 171,276 200,276\" style=\"\"></path><path class=\"to-element from-array\" d=\"M142,300C171,300 171,300 200,300\" style=\"\"></path><path class=\"to-element from-array\" d=\"M142,324C171,324 171,324 200,324\" style=\"\"></path><path class=\"to-element from-array\" d=\"M142,348C171,348 171,348 200,348\" style=\"\"></path><path class=\"to-element from-array\" d=\"M142,372C171,372 171,372 200,372\" style=\"\"></path></g><g class=\"node\"><g class=\"selection\" transform=\"translate(0,192)\" style=\"\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"66\"></rect><text dy=\".35em\" x=\"6\">selection</text></g><g class=\"element\" transform=\"translate(200,12)\" style=\"\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"36\"></rect><text dy=\".35em\" x=\"6\">span</text></g><g class=\"element\" transform=\"translate(200,36)\" style=\"\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"36\"></rect><text dy=\".35em\" x=\"6\">span</text></g><g class=\"element\" transform=\"translate(200,60)\" style=\"\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"36\"></rect><text dy=\".35em\" x=\"6\">span</text></g><g class=\"element\" transform=\"translate(200,84)\" style=\"\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"36\"></rect><text dy=\".35em\" x=\"6\">span</text></g><g class=\"element\" transform=\"translate(200,108)\" style=\"\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"36\"></rect><text dy=\".35em\" x=\"6\">span</text></g><g class=\"element\" transform=\"translate(200,132)\" style=\"\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"36\"></rect><text dy=\".35em\" x=\"6\">span</text></g><g class=\"element\" transform=\"translate(200,156)\" style=\"\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"36\"></rect><text dy=\".35em\" x=\"6\">span</text></g><g class=\"element\" transform=\"translate(200,180)\" style=\"\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"36\"></rect><text dy=\".35em\" x=\"6\">span</text></g><g class=\"element\" transform=\"translate(200,204)\" style=\"\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"36\"></rect><text dy=\".35em\" x=\"6\">span</text></g><g class=\"element\" transform=\"translate(200,228)\" style=\"\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"36\"></rect><text dy=\".35em\" x=\"6\">span</text></g><g class=\"element\" transform=\"translate(200,252)\" style=\"\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"36\"></rect><text dy=\".35em\" x=\"6\">span</text></g><g class=\"element\" transform=\"translate(200,276)\" style=\"\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"36\"></rect><text dy=\".35em\" x=\"6\">span</text></g><g class=\"element\" transform=\"translate(200,300)\" style=\"\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"36\"></rect><text dy=\".35em\" x=\"6\">span</text></g><g class=\"element\" transform=\"translate(200,324)\" style=\"\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"36\"></rect><text dy=\".35em\" x=\"6\">span</text></g><g class=\"element\" transform=\"translate(200,348)\" style=\"\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"36\"></rect><text dy=\".35em\" x=\"6\">span</text></g><g class=\"element\" transform=\"translate(200,372)\" style=\"\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"36\"></rect><text dy=\".35em\" x=\"6\">span</text></g><g class=\"array\" transform=\"translate(100,12)\" style=\"\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"42\"></rect><text dy=\".35em\" x=\"6\">group</text></g><g class=\"array\" transform=\"translate(100,36)\" style=\"\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"42\"></rect><text dy=\".35em\" x=\"6\">group</text></g><g class=\"array\" transform=\"translate(100,60)\" style=\"\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"42\"></rect><text dy=\".35em\" x=\"6\">group</text></g><g class=\"array\" transform=\"translate(100,84)\" style=\"\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"42\"></rect><text dy=\".35em\" x=\"6\">group</text></g><g class=\"array\" transform=\"translate(100,108)\" style=\"\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"42\"></rect><text dy=\".35em\" x=\"6\">group</text></g><g class=\"array\" transform=\"translate(100,132)\" style=\"\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"42\"></rect><text dy=\".35em\" x=\"6\">group</text></g><g class=\"array\" transform=\"translate(100,156)\" style=\"\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"42\"></rect><text dy=\".35em\" x=\"6\">group</text></g><g class=\"array\" transform=\"translate(100,180)\" style=\"\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"42\"></rect><text dy=\".35em\" x=\"6\">group</text></g><g class=\"array\" transform=\"translate(100,204)\" style=\"\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"42\"></rect><text dy=\".35em\" x=\"6\">group</text></g><g class=\"array\" transform=\"translate(100,228)\" style=\"\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"42\"></rect><text dy=\".35em\" x=\"6\">group</text></g><g class=\"array\" transform=\"translate(100,252)\" style=\"\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"42\"></rect><text dy=\".35em\" x=\"6\">group</text></g><g class=\"array\" transform=\"translate(100,276)\" style=\"\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"42\"></rect><text dy=\".35em\" x=\"6\">group</text></g><g class=\"array\" transform=\"translate(100,300)\" style=\"\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"42\"></rect><text dy=\".35em\" x=\"6\">group</text></g><g class=\"array\" transform=\"translate(100,324)\" style=\"\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"42\"></rect><text dy=\".35em\" x=\"6\">group</text></g><g class=\"array\" transform=\"translate(100,348)\" style=\"\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"42\"></rect><text dy=\".35em\" x=\"6\">group</text></g><g class=\"array\" transform=\"translate(100,372)\" style=\"\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"42\"></rect><text dy=\".35em\" x=\"6\">group</text></g></g></g></svg>\n\n<aside>Try inspecting a selection in the JavaScript console to find the groups’ parent nodes. For more on this topic, read my previous tutorial on <a href=\"../nest/\">nested selections</a>.</aside>\n\n<p>Each group has a <code class=\"javascript\">parentNode</code> property which stores the shared parent of all the group’s elements. The parent node is set when the group is created. Thus, if you call <code class=\"javascript\">d3.selectAll(<span class=\"string\">\"tr\"</span>)​.selectAll(<span class=\"string\">\"td\"</span>)</code>, the returned selection contains groups of td elements, whose parents are tr elements. For selections returned by d3.select and d3.selectAll, the parent element is the <a href=\"https://developer.mozilla.org/en-US/docs/DOM/document.documentElement\">document element</a>.\n\n</p><p>大部分时间你可以忽略选集元素被编组.当你使用function去定义选集的属性或样式时, the function is called for each element; the main difference with grouping is that the second argument to your function (<code class=\"javascript\">i</code>) is the within-group index rather than the within-selection index.\n\n<!-- The killer feature for groups is <a href=\"https://github.com/mbostock/d3/wiki/Selections#wiki-data\">selection.data</a>, which allows you to define data per-group (rather than for the entire selection), and thus more easily create hierarchical DOM elements from hierarchical data. We’ll revisit this topic when we get to data joins. -->\n\n</p><h2><a href=\"#non-grouping\" name=\"non-grouping\">#</a>Non-Grouping Operations</h2>\n\n<p>Only selectAll has special behavior regarding grouping; <a href=\"https://github.com/mbostock/d3/wiki/Selections#wiki-select\">select</a> preserves the existing grouping. The select method differs because there is exactly one element in the new selection for each element in the old selection. Thus, select also propagates data from parent to child, whereas selectAll does not (hence the need for a data-join)!\n\n</p><p>The <a href=\"https://github.com/mbostock/d3/blob/master/src/selection/append.js\">append</a> and <a href=\"https://github.com/mbostock/d3/blob/master/src/selection/insert.js\">insert</a> methods are wrappers on top of select, so they also preserve grouping and propagate data. For example, given a document with four sections:\n\n</p><pre><code class=\"javascript\">d3.selectAll(<span class=\"string\">\"section\"</span>);</code></pre>\n\n<script>\n\ntree(\n  {type: \"selection\", name: \"selection\", children: [\n    {type: \"array\", name: \"group\", children: [\n      {type: \"element\", name: \"section\"},\n      {type: \"element\", name: \"section\"},\n      {type: \"element\", name: \"section\"},\n      {type: \"element\", name: \"section\"}\n    ]}\n  ]},\n  24 * 4\n);\n\n</script><svg width=\"800\" height=\"96\" style=\"margin: 1em 0px 1em -40px;\"><g class=\"left\" transform=\"translate(40,0)\"><g class=\"link\"><path class=\"to-array from-selection\" d=\"M66,48C83,48 83,48 100,48\"></path><path class=\"to-element from-array\" d=\"M142,48C171,48 171,12 200,12\"></path><path class=\"to-element from-array\" d=\"M142,48C171,48 171,36 200,36\"></path><path class=\"to-element from-array\" d=\"M142,48C171,48 171,60 200,60\"></path><path class=\"to-element from-array\" d=\"M142,48C171,48 171,84 200,84\"></path></g><g class=\"node\"><g class=\"selection\" transform=\"translate(0,48)\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"66\"></rect><text dy=\".35em\" x=\"6\">selection</text></g><g class=\"array\" transform=\"translate(100,48)\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"42\"></rect><text dy=\".35em\" x=\"6\">group</text></g><g class=\"element\" transform=\"translate(200,12)\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"54\"></rect><text dy=\".35em\" x=\"6\">section</text></g><g class=\"element\" transform=\"translate(200,36)\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"54\"></rect><text dy=\".35em\" x=\"6\">section</text></g><g class=\"element\" transform=\"translate(200,60)\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"54\"></rect><text dy=\".35em\" x=\"6\">section</text></g><g class=\"element\" transform=\"translate(200,84)\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"54\"></rect><text dy=\".35em\" x=\"6\">section</text></g></g></g></svg>\n\n<p>If you append a paragraph element to each section, the new selection likewise has a single group with four elements:\n\n</p><pre><code class=\"javascript\">d3.selectAll(<span class=\"string\">\"section\"</span>).append(<span class=\"string\">\"p\"</span>);</code></pre>\n\n<script>\n\ntree(\n  {type: \"selection\", name: \"selection\", children: [\n    {type: \"array\", name: \"group\", children: [\n      {type: \"element\", name: \"p\"},\n      {type: \"element\", name: \"p\"},\n      {type: \"element\", name: \"p\"},\n      {type: \"element\", name: \"p\"}\n    ]}\n  ]},\n  24 * 4\n);\n\n</script><svg width=\"800\" height=\"96\" style=\"margin: 1em 0px 1em -40px;\"><g class=\"left\" transform=\"translate(40,0)\"><g class=\"link\"><path class=\"to-array from-selection\" d=\"M66,48C83,48 83,48 100,48\"></path><path class=\"to-element from-array\" d=\"M142,48C171,48 171,12 200,12\"></path><path class=\"to-element from-array\" d=\"M142,48C171,48 171,36 200,36\"></path><path class=\"to-element from-array\" d=\"M142,48C171,48 171,60 200,60\"></path><path class=\"to-element from-array\" d=\"M142,48C171,48 171,84 200,84\"></path></g><g class=\"node\"><g class=\"selection\" transform=\"translate(0,48)\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"66\"></rect><text dy=\".35em\" x=\"6\">selection</text></g><g class=\"array\" transform=\"translate(100,48)\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"42\"></rect><text dy=\".35em\" x=\"6\">group</text></g><g class=\"element\" transform=\"translate(200,12)\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"32\"></rect><text dy=\".35em\" x=\"6\">p</text></g><g class=\"element\" transform=\"translate(200,36)\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"32\"></rect><text dy=\".35em\" x=\"6\">p</text></g><g class=\"element\" transform=\"translate(200,60)\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"32\"></rect><text dy=\".35em\" x=\"6\">p</text></g><g class=\"element\" transform=\"translate(200,84)\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"32\"></rect><text dy=\".35em\" x=\"6\">p</text></g></g></g></svg>\n\n<p>Note that the <code class=\"javascript\">parentNode</code> for this selection is still the document element because selection.selectAll has not been called to regroup the selection.\n\n</p><h2><a href=\"#null\" name=\"null\">#</a>Null Elements</h2>\n\n<p>Groups can contain nulls to indicate missing elements. Nulls are ignored for most operations; for example, D3 skips null elements when applying styles and attributes.\n\n</p><p>Null elements can occur when selection.select cannot find a matching element for the given selector. The select method must preserve the grouping structure, so it fills the missing slots with null. For example, if only the last two sections have asides:\n\n</p><pre><code class=\"javascript\">d3.selectAll(<span class=\"string\">\"section\"</span>).select(<span class=\"string\">\"aside\"</span>);</code></pre>\n\n<aside>Here, selection.node would return <code class=\"javascript\">selection[<span class=\"number\">0</span>][<span class=\"number\">2</span>]</code>, because this aside is the first non-null element.</aside>\n\n<script>\n\ntree(\n  {type: \"selection\", name: \"selection\", children: [\n    {type: \"array\", name: \"group\", children: [\n      {type: \"null\", name: \"null\"},\n      {type: \"null\", name: \"null\"},\n      {type: \"element\", name: \"aside\"},\n      {type: \"element\", name: \"aside\"}\n    ]}\n  ]},\n  24 * 4\n);\n\n</script><svg width=\"800\" height=\"96\" style=\"margin: 1em 0px 1em -40px;\"><g class=\"left\" transform=\"translate(40,0)\"><g class=\"link\"><path class=\"to-array from-selection\" d=\"M66,48C83,48 83,48 100,48\"></path><path class=\"to-null from-array\" d=\"M142,48C171,48 171,12 200,12\"></path><path class=\"to-null from-array\" d=\"M142,48C171,48 171,36 200,36\"></path><path class=\"to-element from-array\" d=\"M142,48C171,48 171,60 200,60\"></path><path class=\"to-element from-array\" d=\"M142,48C171,48 171,84 200,84\"></path></g><g class=\"node\"><g class=\"selection\" transform=\"translate(0,48)\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"66\"></rect><text dy=\".35em\" x=\"6\">selection</text></g><g class=\"array\" transform=\"translate(100,48)\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"42\"></rect><text dy=\".35em\" x=\"6\">group</text></g><g class=\"null\" transform=\"translate(200,12)\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"36\"></rect><text dy=\".35em\" x=\"6\">null</text></g><g class=\"null\" transform=\"translate(200,36)\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"36\"></rect><text dy=\".35em\" x=\"6\">null</text></g><g class=\"element\" transform=\"translate(200,60)\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"42\"></rect><text dy=\".35em\" x=\"6\">aside</text></g><g class=\"element\" transform=\"translate(200,84)\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"42\"></rect><text dy=\".35em\" x=\"6\">aside</text></g></g></g></svg>\n\n<p>As with grouping, you can usually ignore null elements, but note their use in preserving the grouped structure of a selection and its within-group index.\n\n<!-- <p>Null elements are critical when handling the result of a data join, which splits a selection into three parts: <i>enter</i>, <i>update</i> and <i>exit</i>. These three selections share the original selection’s structure, with null elements in-between. -->\n\n</p><h2><a href=\"#data\" name=\"data\">#</a>Bound to Data</h2>\n\n<p>稍微有点惊奇, data 不是选集的属性, 而是它的元素的属性.这意味着当你绑定数据到一个选集，数据是被存储在dom上，而不是选集上。 This means that when you bind data to a selection, the data is stored in the DOM rather than in the selection:数据被分配到选集中每一个元素的__data__属性上。 data is assigned to the <code class=\"javascript\">__data__</code> property of each element. 如果一个元素缺少这个属性，则表示分配的数据是undefined。If an element lacks this property, the associated datum is undefined. Data is therefore persistent while selections can be considered transient: you can reselect elements from the DOM and they will retain whatever data was previously bound to them.可以认为数据是持久的，而选集是短暂的。你可以重新选择dom元素，但是绑定到它们的任何数据仍然保持。</p><aside>To verify that data is a property of elements, see <a href=\"https://github.com/mbostock/d3/blob/master/src/selection/datum.js\">selection.datum</a>’s implementation.</aside>\n\n<p>Data is bound to elements one of several ways:</p><ul>\n\n  <li>Joined to groups of elements via <a href=\"https://github.com/mbostock/d3/wiki/Selections#wiki-data\">selection.data</a>.\n  </li><li>Assigned to individual elements via <a href=\"https://github.com/mbostock/d3/wiki/Selections#wiki-datum\">selection.datum</a>.\n  </li><li>Inherited from a parent via append, insert, or select.\n\n</li></ul>\n\n<p>While there is no reason to set the <code class=\"javascript\">__data__</code> property directly when you can use selection.datum, doing so illustrates how data binding is implemented:\n\n</p><aside>You might also find this knowledge useful when inspecting selections in your browser’s developer tools; <code class=\"javascript\">$<span class=\"number\">0</span>.__data__</code> shows the data bound to the inspected element.</aside>\n\n<pre><code class=\"javascript\">document.body.__data__ = <span class=\"number\">42</span>;</code></pre>\n\n<script>\n\ntree(\n  {type: \"element\", name: \"body\", children: [\n    {type: \"datum\", name: \"42\"}\n  ]},\n  24 * 1\n);\n\n</script><svg width=\"800\" height=\"24\" style=\"margin: 1em 0px 1em -40px;\"><g class=\"left\" transform=\"translate(40,0)\"><g class=\"link\"><path class=\"to-datum from-element\" d=\"M36,12C68,12 68,12 100,12\"></path></g><g class=\"node\"><g class=\"element\" transform=\"translate(0,12)\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"36\"></rect><text dy=\".35em\" x=\"6\">body</text></g><g class=\"datum\" transform=\"translate(100,12)\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"32\"></rect><text dy=\".35em\" x=\"6\">42</text></g></g></g></svg>\n\n<p>The D3-idiomatic equivalent is to select the body and call datum: d3相等的做法是选择body然后调用datum方法。</p><p><br></p><pre><code class=\"javascript\">d3.select(<span class=\"string\">\"body\"</span>).datum(<span class=\"number\">42</span>);</code></pre>\n\n<script>\n\ntree(\n  {type: \"selection\", name: \"selection\", children: [\n    {type: \"array\", name: \"group\", children: [\n      {type: \"element\", name: \"body\", children: [\n        {type: \"datum\", name: \"42\"}\n      ]}\n    ]}\n  ]},\n  24 * 1\n);\n\n</script><svg width=\"800\" height=\"24\" style=\"margin: 1em 0px 1em -40px;\"><g class=\"left\" transform=\"translate(40,0)\"><g class=\"link\"><path class=\"to-array from-selection\" d=\"M66,12C83,12 83,12 100,12\"></path><path class=\"to-element from-array\" d=\"M142,12C171,12 171,12 200,12\"></path><path class=\"to-datum from-element\" d=\"M236,12C268,12 268,12 300,12\"></path></g><g class=\"node\"><g class=\"selection\" transform=\"translate(0,12)\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"66\"></rect><text dy=\".35em\" x=\"6\">selection</text></g><g class=\"array\" transform=\"translate(100,12)\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"42\"></rect><text dy=\".35em\" x=\"6\">group</text></g><g class=\"element\" transform=\"translate(200,12)\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"36\"></rect><text dy=\".35em\" x=\"6\">body</text></g><g class=\"datum\" transform=\"translate(300,12)\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"32\"></rect><text dy=\".35em\" x=\"6\">42</text></g></g></g></svg>\n\n<p>If we now append an element to the body, the child automatically inherits data from the parent:\n\n</p><pre><code class=\"javascript\">d3.select(<span class=\"string\">\"body\"</span>).datum(<span class=\"number\">42</span>).append(<span class=\"string\">\"h1\"</span>);</code></pre>\n\n<script>\n\ntree(\n  {type: \"selection\", name: \"selection\", children: [\n    {type: \"array\", name: \"group\", children: [\n      {type: \"element\", name: \"h1\", children: [\n        {type: \"datum\", name: \"42\"}\n      ]}\n    ]}\n  ]},\n  24 * 1\n);\n\n</script><svg width=\"800\" height=\"24\" style=\"margin: 1em 0px 1em -40px;\"><g class=\"left\" transform=\"translate(40,0)\"><g class=\"link\"><path class=\"to-array from-selection\" d=\"M66,12C83,12 83,12 100,12\"></path><path class=\"to-element from-array\" d=\"M142,12C171,12 171,12 200,12\"></path><path class=\"to-datum from-element\" d=\"M232,12C266,12 266,12 300,12\"></path></g><g class=\"node\"><g class=\"selection\" transform=\"translate(0,12)\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"66\"></rect><text dy=\".35em\" x=\"6\">selection</text></g><g class=\"array\" transform=\"translate(100,12)\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"42\"></rect><text dy=\".35em\" x=\"6\">group</text></g><g class=\"element\" transform=\"translate(200,12)\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"32\"></rect><text dy=\".35em\" x=\"6\">h1</text></g><g class=\"datum\" transform=\"translate(300,12)\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"32\"></rect><text dy=\".35em\" x=\"6\">42</text></g></g></g></svg>\n\n<p>And that brings us to the last method of binding data: the mysterious join! But before we can achieve enlightenment, we must answer a more existential question.\n\n</p><p>然后把我们带到最后一个数据绑定方法：最复杂的join！但是在我们深入前，我们必须回答一些额外的问题。</p><h2><a href=\"#data\" name=\"data\">#</a>What is Data?</h2>\n\n<p>Data in D3 can be any array of values. For example, an array of numbers:\n\n</p><pre><code class=\"javascript\"><span class=\"keyword\">var</span> numbers = [<span class=\"number\">4</span>, <span class=\"number\">5</span>, <span class=\"number\">18</span>, <span class=\"number\">23</span>, <span class=\"number\">42</span>];</code></pre>\n\n<p>Or an array of objects:\n\n</p><aside>One of <a href=\"http://alignedleft.com\">Scott Murray</a>’s many tutorials covers <a href=\"http://alignedleft.com/tutorials/d3/data-types/\">common types of data</a> in JavaScript.</aside>\n\n<pre><code class=\"javascript\"><span class=\"keyword\">var</span> letters = [\n  {name: <span class=\"string\">\"A\"</span>, frequency: .<span class=\"number\">08167</span>},\n  {name: <span class=\"string\">\"B\"</span>, frequency: .<span class=\"number\">01492</span>},\n  {name: <span class=\"string\">\"C\"</span>, frequency: .<span class=\"number\">02780</span>},\n  {name: <span class=\"string\">\"D\"</span>, frequency: .<span class=\"number\">04253</span>},\n  {name: <span class=\"string\">\"E\"</span>, frequency: .<span class=\"number\">12702</span>}\n];</code></pre>\n\n<p>Even an array of arrays:\n\n</p><pre><code class=\"javascript\"><span class=\"keyword\">var</span> matrix = [\n  [ <span class=\"number\">0</span>,  <span class=\"number\">1</span>,  <span class=\"number\">2</span>,  <span class=\"number\">3</span>],\n  [ <span class=\"number\">4</span>,  <span class=\"number\">5</span>,  <span class=\"number\">6</span>,  <span class=\"number\">7</span>],\n  [ <span class=\"number\">8</span>,  <span class=\"number\">9</span>, <span class=\"number\">10</span>, <span class=\"number\">11</span>],\n  [<span class=\"number\">12</span>, <span class=\"number\">13</span>, <span class=\"number\">14</span>, <span class=\"number\">15</span>]\n];</code></pre>\n\n<p>We can mirror the visual representation of selections to represent data. Here’s a plain array of five numbers:\n\n<script>\n\ntree(\n  null,\n  {type: \"array\", name: \"array\", children: [\n    {type: \"datum\", name: \"4\"},\n    {type: \"datum\", name: \"5\"},\n    {type: \"datum\", name: \"18\"},\n    {type: \"datum\", name: \"23\"},\n    {type: \"datum\", name: \"42\"}\n  ]},\n  24 * 5\n);\n\n</script>\n\n</p><svg width=\"800\" height=\"120\" style=\"margin: 1em 0px 1em -40px;\"><g class=\"right\" transform=\"translate(760,0)\"><g class=\"link\"><path class=\"to-datum from-array\" d=\"M-42,60C-71,60 -71,12 -100,12\"></path><path class=\"to-datum from-array\" d=\"M-42,60C-71,60 -71,36 -100,36\"></path><path class=\"to-datum from-array\" d=\"M-42,60C-71,60 -71,60 -100,60\"></path><path class=\"to-datum from-array\" d=\"M-42,60C-71,60 -71,84 -100,84\"></path><path class=\"to-datum from-array\" d=\"M-42,60C-71,60 -71,108 -100,108\"></path></g><g class=\"node\"><g class=\"array\" transform=\"translate(0,60)\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"42\" x=\"-42\"></rect><text dy=\".35em\" x=\"-36\">array</text></g><g class=\"datum\" transform=\"translate(-100,12)\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"32\" x=\"-32\"></rect><text dy=\".35em\" x=\"-26\">4</text></g><g class=\"datum\" transform=\"translate(-100,36)\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"32\" x=\"-32\"></rect><text dy=\".35em\" x=\"-26\">5</text></g><g class=\"datum\" transform=\"translate(-100,60)\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"32\" x=\"-32\"></rect><text dy=\".35em\" x=\"-26\">18</text></g><g class=\"datum\" transform=\"translate(-100,84)\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"32\" x=\"-32\"></rect><text dy=\".35em\" x=\"-26\">23</text></g><g class=\"datum\" transform=\"translate(-100,108)\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"32\" x=\"-32\"></rect><text dy=\".35em\" x=\"-26\">42</text></g></g></g></svg><p>Just as selection.style takes either a constant string to define a uniform style property (<i>e.g.</i>, <code class=\"javascript\"><span class=\"string\">\"red\"</span></code>) for every selected element, or a function to compute a dynamic style per-element (<code class=\"javascript\"><span class=\"function\"><span class=\"keyword\">function</span><span class=\"params\">(d)</span> {</span> <span class=\"keyword\">return</span> d.color; }</code>), <a href=\"https://github.com/mbostock/d3/wiki/Selections#wiki-data\">selection.data</a> can accept either a constant value or a function.\n\n</p><p><span style=\"line-height: 1.5em;\">就像selection.style接受一个直接量字符串定义style属性或一个function动态计算每个元素的style，selection.data也接受一个直接量或function。</span><br></p><p>However, unlike the other selection methods, <b>selection.data defines data per-group rather than per-element</b>: data is expressed as an array of values for the group, or a function that returns such an array. Thus, a <a href=\"#group\">grouped</a> selection has correspondingly grouped data!\n\n</p><p>然而不象其它的selection方法，seletion.data对每个编组定义数据而不是每个元素。data，因此一个编组的selection有相应的编组数据。</p><aside>Since there are four groups in the selection, this data function is invoked four times and returns four arrays (one per invocation). Each returned array here also happens to contain four values, but returned arrays may vary in length depending on data.</aside>\n\n<script>\n\ntree(\n  null,\n  {type: \"data\", name: \"data\", children: [\n    {type: \"array\", name: \"array\", children: [\n      {type: \"datum\", name: \"0\"},\n      {type: \"datum\", name: \"1\"},\n      {type: \"datum\", name: \"2\"},\n      {type: \"datum\", name: \"3\"}\n    ]},\n    {type: \"array\", name: \"array\", children: [\n      {type: \"datum\", name: \"4\"},\n      {type: \"datum\", name: \"5\"},\n      {type: \"datum\", name: \"6\"},\n      {type: \"datum\", name: \"7\"}\n    ]},\n    {type: \"array\", name: \"array\", children: [\n      {type: \"datum\", name: \"8\"},\n      {type: \"datum\", name: \"9\"},\n      {type: \"datum\", name: \"10\"},\n      {type: \"datum\", name: \"11\"}\n    ]},\n    {type: \"array\", name: \"array\", children: [\n      {type: \"datum\", name: \"12\"},\n      {type: \"datum\", name: \"13\"},\n      {type: \"datum\", name: \"14\"},\n      {type: \"datum\", name: \"15\"}\n    ]}\n  ]},\n  24 * 16\n);\n\n</script><svg width=\"800\" height=\"384\" style=\"margin: 1em 0px 1em -40px;\"><g class=\"right\" transform=\"translate(760,0)\"><g class=\"link\"><path class=\"to-array from-data\" d=\"M-36,192C-68,192 -68,48 -100,48\"></path><path class=\"to-array from-data\" d=\"M-36,192C-68,192 -68,144 -100,144\"></path><path class=\"to-array from-data\" d=\"M-36,192C-68,192 -68,240 -100,240\"></path><path class=\"to-array from-data\" d=\"M-36,192C-68,192 -68,336 -100,336\"></path><path class=\"to-datum from-array\" d=\"M-142,48C-171,48 -171,12 -200,12\"></path><path class=\"to-datum from-array\" d=\"M-142,48C-171,48 -171,36 -200,36\"></path><path class=\"to-datum from-array\" d=\"M-142,48C-171,48 -171,60 -200,60\"></path><path class=\"to-datum from-array\" d=\"M-142,48C-171,48 -171,84 -200,84\"></path><path class=\"to-datum from-array\" d=\"M-142,144C-171,144 -171,108 -200,108\"></path><path class=\"to-datum from-array\" d=\"M-142,144C-171,144 -171,132 -200,132\"></path><path class=\"to-datum from-array\" d=\"M-142,144C-171,144 -171,156 -200,156\"></path><path class=\"to-datum from-array\" d=\"M-142,144C-171,144 -171,180 -200,180\"></path><path class=\"to-datum from-array\" d=\"M-142,240C-171,240 -171,204 -200,204\"></path><path class=\"to-datum from-array\" d=\"M-142,240C-171,240 -171,228 -200,228\"></path><path class=\"to-datum from-array\" d=\"M-142,240C-171,240 -171,252 -200,252\"></path><path class=\"to-datum from-array\" d=\"M-142,240C-171,240 -171,276 -200,276\"></path><path class=\"to-datum from-array\" d=\"M-142,336C-171,336 -171,300 -200,300\"></path><path class=\"to-datum from-array\" d=\"M-142,336C-171,336 -171,324 -200,324\"></path><path class=\"to-datum from-array\" d=\"M-142,336C-171,336 -171,348 -200,348\"></path><path class=\"to-datum from-array\" d=\"M-142,336C-171,336 -171,372 -200,372\"></path></g><g class=\"node\"><g class=\"data\" transform=\"translate(0,192)\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"36\" x=\"-36\"></rect><text dy=\".35em\" x=\"-30\">data</text></g><g class=\"array\" transform=\"translate(-100,48)\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"42\" x=\"-42\"></rect><text dy=\".35em\" x=\"-36\">array</text></g><g class=\"datum\" transform=\"translate(-200,12)\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"32\" x=\"-32\"></rect><text dy=\".35em\" x=\"-26\">0</text></g><g class=\"datum\" transform=\"translate(-200,36)\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"32\" x=\"-32\"></rect><text dy=\".35em\" x=\"-26\">1</text></g><g class=\"datum\" transform=\"translate(-200,60)\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"32\" x=\"-32\"></rect><text dy=\".35em\" x=\"-26\">2</text></g><g class=\"datum\" transform=\"translate(-200,84)\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"32\" x=\"-32\"></rect><text dy=\".35em\" x=\"-26\">3</text></g><g class=\"array\" transform=\"translate(-100,144)\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"42\" x=\"-42\"></rect><text dy=\".35em\" x=\"-36\">array</text></g><g class=\"datum\" transform=\"translate(-200,108)\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"32\" x=\"-32\"></rect><text dy=\".35em\" x=\"-26\">4</text></g><g class=\"datum\" transform=\"translate(-200,132)\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"32\" x=\"-32\"></rect><text dy=\".35em\" x=\"-26\">5</text></g><g class=\"datum\" transform=\"translate(-200,156)\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"32\" x=\"-32\"></rect><text dy=\".35em\" x=\"-26\">6</text></g><g class=\"datum\" transform=\"translate(-200,180)\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"32\" x=\"-32\"></rect><text dy=\".35em\" x=\"-26\">7</text></g><g class=\"array\" transform=\"translate(-100,240)\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"42\" x=\"-42\"></rect><text dy=\".35em\" x=\"-36\">array</text></g><g class=\"datum\" transform=\"translate(-200,204)\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"32\" x=\"-32\"></rect><text dy=\".35em\" x=\"-26\">8</text></g><g class=\"datum\" transform=\"translate(-200,228)\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"32\" x=\"-32\"></rect><text dy=\".35em\" x=\"-26\">9</text></g><g class=\"datum\" transform=\"translate(-200,252)\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"32\" x=\"-32\"></rect><text dy=\".35em\" x=\"-26\">10</text></g><g class=\"datum\" transform=\"translate(-200,276)\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"32\" x=\"-32\"></rect><text dy=\".35em\" x=\"-26\">11</text></g><g class=\"array\" transform=\"translate(-100,336)\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"42\" x=\"-42\"></rect><text dy=\".35em\" x=\"-36\">array</text></g><g class=\"datum\" transform=\"translate(-200,300)\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"32\" x=\"-32\"></rect><text dy=\".35em\" x=\"-26\">12</text></g><g class=\"datum\" transform=\"translate(-200,324)\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"32\" x=\"-32\"></rect><text dy=\".35em\" x=\"-26\">13</text></g><g class=\"datum\" transform=\"translate(-200,348)\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"32\" x=\"-32\"></rect><text dy=\".35em\" x=\"-26\">14</text></g><g class=\"datum\" transform=\"translate(-200,372)\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"32\" x=\"-32\"></rect><text dy=\".35em\" x=\"-26\">15</text></g></g></g></svg>\n\n<p>The blue lines in the diagram indicate that the <span style=\"display:inline-block;position:relative;width:55px;\"><svg style=\"position:absolute;top:-17px;\" class=\"node\" width=\"55\" height=\"22\"><g transform=\"translate(1,1)\" class=\"data\"><rect rx=\"6\" ry=\"6\" width=\"53\" height=\"20\"></rect><text x=\"26\" y=\"10\" dy=\".35em\" text-anchor=\"middle\">data</text></g></svg></span> function <i>returns</i> the linked array. Your data function is passed the datum of the group’s <code class=\"javascript\">parentNode</code> (<code class=\"javascript\">d</code>) and the group’s index (<code class=\"javascript\">i</code>), and returns whatever array of data you want to join to that group. Thus, data is typically expressed as a function of parent data, facilitating the creation of hierarchical DOM elements from hierarchical data.\n\n</p><p>For selections with only a single group, you can pass the corresponding single array to selection.data directly; you only need a function when binding different data to different groups.\n\n</p><h2><a href=\"#key\" name=\"key\">#</a>The Key to Enlightenment</h2>\n\n<p>To join data to elements, we must know which datum should be assigned to which element. This is done by pairing keys. A <i>key</i> is simply an identifying string, such as a name; when the key for a datum and an element are equal, the datum is assigned to that element.\n\n</p><p>The simplest method of assigning keys is by index: the first datum and the first element have the key “0”, the second datum and element have the key “1”, and so on. Joining an array of numbers to a matching array of paragraph elements therefore looks like this, with keys shown in green:\n\n</p><pre><code class=\"javascript\"><span class=\"keyword\">var</span> numbers = [<span class=\"number\">4</span>, <span class=\"number\">5</span>, <span class=\"number\">18</span>, <span class=\"number\">23</span>, <span class=\"number\">42</span>];</code></pre>\n\n<script>\n\ntree(\n  {type: \"selection\", name: \"selection\", children: [\n    {type: \"array\", name: \"group\", children: [\n      {type: \"element\", name: \"element\", children: [{type: \"key\", name: \"0\", join: 0}]},\n      {type: \"element\", name: \"element\", children: [{type: \"key\", name: \"1\", join: 0}]},\n      {type: \"element\", name: \"element\", children: [{type: \"key\", name: \"2\", join: 0}]},\n      {type: \"element\", name: \"element\", children: [{type: \"key\", name: \"3\", join: 0}]},\n      {type: \"element\", name: \"element\", children: [{type: \"key\", name: \"4\", join: 0}]}\n    ]}\n  ]},\n  {type: \"data\", name: \"data\", children: [\n    {type: \"array\", name: \"array\", children: [\n      {type: \"datum\", name: \"4\", children: [{type: \"key\", name: \"0\"}]},\n      {type: \"datum\", name: \"5\", children: [{type: \"key\", name: \"1\"}]},\n      {type: \"datum\", name: \"18\", children: [{type: \"key\", name: \"2\"}]},\n      {type: \"datum\", name: \"23\", children: [{type: \"key\", name: \"3\"}]},\n      {type: \"datum\", name: \"42\", children: [{type: \"key\", name: \"4\"}]}\n    ]}\n  ]},\n  24 * 5\n);\n\n</script><svg width=\"800\" height=\"120\" style=\"margin: 1em 0px 1em -40px;\"><g class=\"left\" transform=\"translate(40,0)\"><g class=\"link\"><path class=\"to-array from-selection\" d=\"M66,60C83,60 83,60 100,60\"></path><path class=\"to-element from-array\" d=\"M142,60C171,60 171,12 200,12\"></path><path class=\"to-element from-array\" d=\"M142,60C171,60 171,36 200,36\"></path><path class=\"to-element from-array\" d=\"M142,60C171,60 171,60 200,60\"></path><path class=\"to-element from-array\" d=\"M142,60C171,60 171,84 200,84\"></path><path class=\"to-element from-array\" d=\"M142,60C171,60 171,108 200,108\"></path><path class=\"to-key from-element\" d=\"M254,12C277,12 277,12 300,12\"></path><path class=\"to-key from-element\" d=\"M254,36C277,36 277,36 300,36\"></path><path class=\"to-key from-element\" d=\"M254,60C277,60 277,60 300,60\"></path><path class=\"to-key from-element\" d=\"M254,84C277,84 277,84 300,84\"></path><path class=\"to-key from-element\" d=\"M254,108C277,108 277,108 300,108\"></path></g><g class=\"node\"><g class=\"selection\" transform=\"translate(0,60)\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"66\"></rect><text dy=\".35em\" x=\"6\">selection</text></g><g class=\"array\" transform=\"translate(100,60)\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"42\"></rect><text dy=\".35em\" x=\"6\">group</text></g><g class=\"element\" transform=\"translate(200,12)\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"54\"></rect><text dy=\".35em\" x=\"6\">element</text></g><g class=\"key\" transform=\"translate(300,12)\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"32\"></rect><path class=\"join\" d=\"M32,0C60,0 60,0 88,0\"></path><text dy=\".35em\" x=\"6\">0</text></g><g class=\"element\" transform=\"translate(200,36)\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"54\"></rect><text dy=\".35em\" x=\"6\">element</text></g><g class=\"key\" transform=\"translate(300,36)\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"32\"></rect><path class=\"join\" d=\"M32,0C60,0 60,0 88,0\"></path><text dy=\".35em\" x=\"6\">1</text></g><g class=\"element\" transform=\"translate(200,60)\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"54\"></rect><text dy=\".35em\" x=\"6\">element</text></g><g class=\"key\" transform=\"translate(300,60)\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"32\"></rect><path class=\"join\" d=\"M32,0C60,0 60,0 88,0\"></path><text dy=\".35em\" x=\"6\">2</text></g><g class=\"element\" transform=\"translate(200,84)\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"54\"></rect><text dy=\".35em\" x=\"6\">element</text></g><g class=\"key\" transform=\"translate(300,84)\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"32\"></rect><path class=\"join\" d=\"M32,0C60,0 60,0 88,0\"></path><text dy=\".35em\" x=\"6\">3</text></g><g class=\"element\" transform=\"translate(200,108)\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"54\"></rect><text dy=\".35em\" x=\"6\">element</text></g><g class=\"key\" transform=\"translate(300,108)\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"32\"></rect><path class=\"join\" d=\"M32,0C60,0 60,0 88,0\"></path><text dy=\".35em\" x=\"6\">4</text></g></g></g><g class=\"right\" transform=\"translate(760,0)\"><g class=\"link\"><path class=\"to-array from-data\" d=\"M-36,60C-68,60 -68,60 -100,60\"></path><path class=\"to-datum from-array\" d=\"M-142,60C-171,60 -171,12 -200,12\"></path><path class=\"to-datum from-array\" d=\"M-142,60C-171,60 -171,36 -200,36\"></path><path class=\"to-datum from-array\" d=\"M-142,60C-171,60 -171,60 -200,60\"></path><path class=\"to-datum from-array\" d=\"M-142,60C-171,60 -171,84 -200,84\"></path><path class=\"to-datum from-array\" d=\"M-142,60C-171,60 -171,108 -200,108\"></path><path class=\"to-key from-datum\" d=\"M-232,12C-266,12 -266,12 -300,12\"></path><path class=\"to-key from-datum\" d=\"M-232,36C-266,36 -266,36 -300,36\"></path><path class=\"to-key from-datum\" d=\"M-232,60C-266,60 -266,60 -300,60\"></path><path class=\"to-key from-datum\" d=\"M-232,84C-266,84 -266,84 -300,84\"></path><path class=\"to-key from-datum\" d=\"M-232,108C-266,108 -266,108 -300,108\"></path></g><g class=\"node\"><g class=\"data\" transform=\"translate(0,60)\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"36\" x=\"-36\"></rect><text dy=\".35em\" x=\"-30\">data</text></g><g class=\"array\" transform=\"translate(-100,60)\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"42\" x=\"-42\"></rect><text dy=\".35em\" x=\"-36\">array</text></g><g class=\"datum\" transform=\"translate(-200,12)\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"32\" x=\"-32\"></rect><text dy=\".35em\" x=\"-26\">4</text></g><g class=\"key\" transform=\"translate(-300,12)\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"32\" x=\"-32\"></rect><text dy=\".35em\" x=\"-26\">0</text></g><g class=\"datum\" transform=\"translate(-200,36)\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"32\" x=\"-32\"></rect><text dy=\".35em\" x=\"-26\">5</text></g><g class=\"key\" transform=\"translate(-300,36)\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"32\" x=\"-32\"></rect><text dy=\".35em\" x=\"-26\">1</text></g><g class=\"datum\" transform=\"translate(-200,60)\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"32\" x=\"-32\"></rect><text dy=\".35em\" x=\"-26\">18</text></g><g class=\"key\" transform=\"translate(-300,60)\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"32\" x=\"-32\"></rect><text dy=\".35em\" x=\"-26\">2</text></g><g class=\"datum\" transform=\"translate(-200,84)\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"32\" x=\"-32\"></rect><text dy=\".35em\" x=\"-26\">23</text></g><g class=\"key\" transform=\"translate(-300,84)\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"32\" x=\"-32\"></rect><text dy=\".35em\" x=\"-26\">3</text></g><g class=\"datum\" transform=\"translate(-200,108)\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"32\" x=\"-32\"></rect><text dy=\".35em\" x=\"-26\">42</text></g><g class=\"key\" transform=\"translate(-300,108)\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"32\" x=\"-32\"></rect><text dy=\".35em\" x=\"-26\">4</text></g></g></g></svg>\n\n<p>The resulting selection now has elements bound to data:\n\n</p><pre><code class=\"javascript\">d3.selectAll(<span class=\"string\">\"div\"</span>).data(numbers);</code></pre>\n\n<aside><a href=\"http://macwright.org/\">Tom MacWright</a>’s “fun, difficult” <a href=\"http://macwright.org/presentations/dcjq/\">introduction to D3</a> explains data joins by way of a simple <a href=\"http://macwright.org/mistakes/#5010465\" style=\"white-space:nowrap;\">reimplementation</a>.</aside>\n\n<script>\n\ntree(\n  {type: \"selection\", name: \"selection\", children: [\n    {type: \"array\", name: \"group\", children: [\n      {type: \"element\", name: \"div\", children: [{type: \"datum\", name: \"4\"}]},\n      {type: \"element\", name: \"div\", children: [{type: \"datum\", name: \"5\"}]},\n      {type: \"element\", name: \"div\", children: [{type: \"datum\", name: \"18\"}]},\n      {type: \"element\", name: \"div\", children: [{type: \"datum\", name: \"23\"}]},\n      {type: \"element\", name: \"div\", children: [{type: \"datum\", name: \"42\"}]}\n    ]}\n  ]},\n  24 * 5\n);\n\n</script><svg width=\"800\" height=\"120\" style=\"margin: 1em 0px 1em -40px;\"><g class=\"left\" transform=\"translate(40,0)\"><g class=\"link\"><path class=\"to-array from-selection\" d=\"M66,60C83,60 83,60 100,60\"></path><path class=\"to-element from-array\" d=\"M142,60C171,60 171,12 200,12\"></path><path class=\"to-element from-array\" d=\"M142,60C171,60 171,36 200,36\"></path><path class=\"to-element from-array\" d=\"M142,60C171,60 171,60 200,60\"></path><path class=\"to-element from-array\" d=\"M142,60C171,60 171,84 200,84\"></path><path class=\"to-element from-array\" d=\"M142,60C171,60 171,108 200,108\"></path><path class=\"to-datum from-element\" d=\"M232,12C266,12 266,12 300,12\"></path><path class=\"to-datum from-element\" d=\"M232,36C266,36 266,36 300,36\"></path><path class=\"to-datum from-element\" d=\"M232,60C266,60 266,60 300,60\"></path><path class=\"to-datum from-element\" d=\"M232,84C266,84 266,84 300,84\"></path><path class=\"to-datum from-element\" d=\"M232,108C266,108 266,108 300,108\"></path></g><g class=\"node\"><g class=\"selection\" transform=\"translate(0,60)\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"66\"></rect><text dy=\".35em\" x=\"6\">selection</text></g><g class=\"array\" transform=\"translate(100,60)\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"42\"></rect><text dy=\".35em\" x=\"6\">group</text></g><g class=\"element\" transform=\"translate(200,12)\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"32\"></rect><text dy=\".35em\" x=\"6\">div</text></g><g class=\"datum\" transform=\"translate(300,12)\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"32\"></rect><text dy=\".35em\" x=\"6\">4</text></g><g class=\"element\" transform=\"translate(200,36)\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"32\"></rect><text dy=\".35em\" x=\"6\">div</text></g><g class=\"datum\" transform=\"translate(300,36)\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"32\"></rect><text dy=\".35em\" x=\"6\">5</text></g><g class=\"element\" transform=\"translate(200,60)\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"32\"></rect><text dy=\".35em\" x=\"6\">div</text></g><g class=\"datum\" transform=\"translate(300,60)\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"32\"></rect><text dy=\".35em\" x=\"6\">18</text></g><g class=\"element\" transform=\"translate(200,84)\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"32\"></rect><text dy=\".35em\" x=\"6\">div</text></g><g class=\"datum\" transform=\"translate(300,84)\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"32\"></rect><text dy=\".35em\" x=\"6\">23</text></g><g class=\"element\" transform=\"translate(200,108)\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"32\"></rect><text dy=\".35em\" x=\"6\">div</text></g><g class=\"datum\" transform=\"translate(300,108)\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"32\"></rect><text dy=\".35em\" x=\"6\">42</text></g></g></g></svg>\n\n<p>Joining by index is convenient if your data and elements are in the same order. However, when orders differ, joining by index is insufficient! In this case, you can specify a <a href=\"../constancy/#key-functions\">key function</a> as the second argument to selection.data. The key function returns the key for a given datum or element. For example, if your data is an array of objects, each with a <code class=\"javascript\">name</code> property, your key function can return the associated name:\n\n</p><pre><code class=\"javascript\"><span class=\"keyword\">var</span> letters = [\n  {name: <span class=\"string\">\"A\"</span>, frequency: .<span class=\"number\">08167</span>},\n  {name: <span class=\"string\">\"B\"</span>, frequency: .<span class=\"number\">01492</span>},\n  {name: <span class=\"string\">\"C\"</span>, frequency: .<span class=\"number\">02780</span>},\n  {name: <span class=\"string\">\"D\"</span>, frequency: .<span class=\"number\">04253</span>},\n  {name: <span class=\"string\">\"E\"</span>, frequency: .<span class=\"number\">12702</span>}\n];\n\n<span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">name</span><span class=\"params\">(d)</span> {</span>\n  <span class=\"keyword\">return</span> d.name;\n}</code></pre>\n\n<aside>The key function is called for each old element and each new data: ten times in this example. The previously-bound data is used to compute old keys, while the new data is used to compute new keys.</aside>\n\n<script>\n\ntree(\n  {type: \"selection\", name: \"selection\", children: [\n    {type: \"array\", name: \"group\", children: [\n      {type: \"element\", name: \"element\", children: [{type: \"key\", name: \"B\", join: 1}]},\n      {type: \"element\", name: \"element\", children: [{type: \"key\", name: \"A\", join: -1}]},\n      {type: \"element\", name: \"element\", children: [{type: \"key\", name: \"D\", join: 1}]},\n      {type: \"element\", name: \"element\", children: [{type: \"key\", name: \"C\", join: -1}]},\n      {type: \"element\", name: \"element\", children: [{type: \"key\", name: \"E\", join: 0}]}\n    ]}\n  ]},\n  {type: \"data\", name: \"data\", children: [\n    {type: \"array\", name: \"array\", children: [\n      {type: \"code datum\", name: \"{name: \\\"A\\\"}\", children: [{type: \"key\", name: \"A\"}]},\n      {type: \"code datum\", name: \"{name: \\\"B\\\"}\", children: [{type: \"key\", name: \"B\"}]},\n      {type: \"code datum\", name: \"{name: \\\"C\\\"}\", children: [{type: \"key\", name: \"C\"}]},\n      {type: \"code datum\", name: \"{name: \\\"D\\\"}\", children: [{type: \"key\", name: \"D\"}]},\n      {type: \"code datum\", name: \"{name: \\\"E\\\"}\", children: [{type: \"key\", name: \"E\"}]}\n    ]}\n  ]},\n  24 * 5\n);\n\n</script><svg width=\"800\" height=\"120\" style=\"margin: 1em 0px 1em -40px;\"><g class=\"left\" transform=\"translate(40,0)\"><g class=\"link\"><path class=\"to-array from-selection\" d=\"M66,60C83,60 83,60 100,60\"></path><path class=\"to-element from-array\" d=\"M142,60C171,60 171,12 200,12\"></path><path class=\"to-element from-array\" d=\"M142,60C171,60 171,36 200,36\"></path><path class=\"to-element from-array\" d=\"M142,60C171,60 171,60 200,60\"></path><path class=\"to-element from-array\" d=\"M142,60C171,60 171,84 200,84\"></path><path class=\"to-element from-array\" d=\"M142,60C171,60 171,108 200,108\"></path><path class=\"to-key from-element\" d=\"M254,12C277,12 277,12 300,12\"></path><path class=\"to-key from-element\" d=\"M254,36C277,36 277,36 300,36\"></path><path class=\"to-key from-element\" d=\"M254,60C277,60 277,60 300,60\"></path><path class=\"to-key from-element\" d=\"M254,84C277,84 277,84 300,84\"></path><path class=\"to-key from-element\" d=\"M254,108C277,108 277,108 300,108\"></path></g><g class=\"node\"><g class=\"selection\" transform=\"translate(0,60)\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"66\"></rect><text dy=\".35em\" x=\"6\">selection</text></g><g class=\"array\" transform=\"translate(100,60)\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"42\"></rect><text dy=\".35em\" x=\"6\">group</text></g><g class=\"element\" transform=\"translate(200,12)\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"54\"></rect><text dy=\".35em\" x=\"6\">element</text></g><g class=\"key\" transform=\"translate(300,12)\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"32\"></rect><path class=\"join\" d=\"M32,0C60,0 60,24 88,24\"></path><text dy=\".35em\" x=\"6\">B</text></g><g class=\"element\" transform=\"translate(200,36)\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"54\"></rect><text dy=\".35em\" x=\"6\">element</text></g><g class=\"key\" transform=\"translate(300,36)\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"32\"></rect><path class=\"join\" d=\"M32,0C60,0 60,-24 88,-24\"></path><text dy=\".35em\" x=\"6\">A</text></g><g class=\"element\" transform=\"translate(200,60)\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"54\"></rect><text dy=\".35em\" x=\"6\">element</text></g><g class=\"key\" transform=\"translate(300,60)\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"32\"></rect><path class=\"join\" d=\"M32,0C60,0 60,24 88,24\"></path><text dy=\".35em\" x=\"6\">D</text></g><g class=\"element\" transform=\"translate(200,84)\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"54\"></rect><text dy=\".35em\" x=\"6\">element</text></g><g class=\"key\" transform=\"translate(300,84)\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"32\"></rect><path class=\"join\" d=\"M32,0C60,0 60,-24 88,-24\"></path><text dy=\".35em\" x=\"6\">C</text></g><g class=\"element\" transform=\"translate(200,108)\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"54\"></rect><text dy=\".35em\" x=\"6\">element</text></g><g class=\"key\" transform=\"translate(300,108)\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"32\"></rect><path class=\"join\" d=\"M32,0C60,0 60,0 88,0\"></path><text dy=\".35em\" x=\"6\">E</text></g></g></g><g class=\"right\" transform=\"translate(760,0)\"><g class=\"link\"><path class=\"to-array from-data\" d=\"M-36,60C-68,60 -68,60 -100,60\"></path><path class=\"to-code to-datum from-array\" d=\"M-142,60C-171,60 -171,12 -200,12\"></path><path class=\"to-code to-datum from-array\" d=\"M-142,60C-171,60 -171,36 -200,36\"></path><path class=\"to-code to-datum from-array\" d=\"M-142,60C-171,60 -171,60 -200,60\"></path><path class=\"to-code to-datum from-array\" d=\"M-142,60C-171,60 -171,84 -200,84\"></path><path class=\"to-code to-datum from-array\" d=\"M-142,60C-171,60 -171,108 -200,108\"></path><path class=\"to-key from-code from-datum\" d=\"M-278,12C-289,12 -289,12 -300,12\"></path><path class=\"to-key from-code from-datum\" d=\"M-278,36C-289,36 -289,36 -300,36\"></path><path class=\"to-key from-code from-datum\" d=\"M-278,60C-289,60 -289,60 -300,60\"></path><path class=\"to-key from-code from-datum\" d=\"M-278,84C-289,84 -289,84 -300,84\"></path><path class=\"to-key from-code from-datum\" d=\"M-278,108C-289,108 -289,108 -300,108\"></path></g><g class=\"node\"><g class=\"data\" transform=\"translate(0,60)\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"36\" x=\"-36\"></rect><text dy=\".35em\" x=\"-30\">data</text></g><g class=\"array\" transform=\"translate(-100,60)\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"42\" x=\"-42\"></rect><text dy=\".35em\" x=\"-36\">array</text></g><g class=\"code datum\" transform=\"translate(-200,12)\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"78\" x=\"-78\"></rect><text dy=\".35em\" x=\"-72\">{name: \"A\"}</text></g><g class=\"key\" transform=\"translate(-300,12)\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"32\" x=\"-32\"></rect><text dy=\".35em\" x=\"-26\">A</text></g><g class=\"code datum\" transform=\"translate(-200,36)\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"78\" x=\"-78\"></rect><text dy=\".35em\" x=\"-72\">{name: \"B\"}</text></g><g class=\"key\" transform=\"translate(-300,36)\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"32\" x=\"-32\"></rect><text dy=\".35em\" x=\"-26\">B</text></g><g class=\"code datum\" transform=\"translate(-200,60)\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"78\" x=\"-78\"></rect><text dy=\".35em\" x=\"-72\">{name: \"C\"}</text></g><g class=\"key\" transform=\"translate(-300,60)\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"32\" x=\"-32\"></rect><text dy=\".35em\" x=\"-26\">C</text></g><g class=\"code datum\" transform=\"translate(-200,84)\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"78\" x=\"-78\"></rect><text dy=\".35em\" x=\"-72\">{name: \"D\"}</text></g><g class=\"key\" transform=\"translate(-300,84)\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"32\" x=\"-32\"></rect><text dy=\".35em\" x=\"-26\">D</text></g><g class=\"code datum\" transform=\"translate(-200,108)\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"78\" x=\"-78\"></rect><text dy=\".35em\" x=\"-72\">{name: \"E\"}</text></g><g class=\"key\" transform=\"translate(-300,108)\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"32\" x=\"-32\"></rect><text dy=\".35em\" x=\"-26\">E</text></g></g></g></svg>\n\n<p>Again, the selected elements are now bound to data. The elements have also been reordered within the selection to match the data:\n\n</p><aside>Although the selection now matches the data, the elements are <i>not</i> automatically reordered in the DOM. For that you must call <a href=\"https://github.com/mbostock/d3/wiki/Selections#wiki-order\">selection.order</a> or <a href=\"https://github.com/mbostock/d3/wiki/Selections#wiki-sort\">selection.sort</a>.</aside>\n\n<pre><code class=\"javascript\">d3.selectAll(<span class=\"string\">\"div\"</span>).data(letters, name);</code></pre>\n\n<script>\n\ntree(\n  {type: \"selection\", name: \"selection\", children: [\n    {type: \"array\", name: \"group\", children: [\n      {type: \"element\", name: \"div\", children: [{type: \"code datum\", name: \"{name: \\\"A\\\"}\"}]},\n      {type: \"element\", name: \"div\", children: [{type: \"code datum\", name: \"{name: \\\"B\\\"}\"}]},\n      {type: \"element\", name: \"div\", children: [{type: \"code datum\", name: \"{name: \\\"C\\\"}\"}]},\n      {type: \"element\", name: \"div\", children: [{type: \"code datum\", name: \"{name: \\\"D\\\"}\"}]},\n      {type: \"element\", name: \"div\", children: [{type: \"code datum\", name: \"{name: \\\"E\\\"}\"}]}\n    ]}\n  ]},\n  24 * 5\n);\n\n</script><svg width=\"800\" height=\"120\" style=\"margin: 1em 0px 1em -40px;\"><g class=\"left\" transform=\"translate(40,0)\"><g class=\"link\"><path class=\"to-array from-selection\" d=\"M66,60C83,60 83,60 100,60\"></path><path class=\"to-element from-array\" d=\"M142,60C171,60 171,12 200,12\"></path><path class=\"to-element from-array\" d=\"M142,60C171,60 171,36 200,36\"></path><path class=\"to-element from-array\" d=\"M142,60C171,60 171,60 200,60\"></path><path class=\"to-element from-array\" d=\"M142,60C171,60 171,84 200,84\"></path><path class=\"to-element from-array\" d=\"M142,60C171,60 171,108 200,108\"></path><path class=\"to-code to-datum from-element\" d=\"M232,12C266,12 266,12 300,12\"></path><path class=\"to-code to-datum from-element\" d=\"M232,36C266,36 266,36 300,36\"></path><path class=\"to-code to-datum from-element\" d=\"M232,60C266,60 266,60 300,60\"></path><path class=\"to-code to-datum from-element\" d=\"M232,84C266,84 266,84 300,84\"></path><path class=\"to-code to-datum from-element\" d=\"M232,108C266,108 266,108 300,108\"></path></g><g class=\"node\"><g class=\"selection\" transform=\"translate(0,60)\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"66\"></rect><text dy=\".35em\" x=\"6\">selection</text></g><g class=\"array\" transform=\"translate(100,60)\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"42\"></rect><text dy=\".35em\" x=\"6\">group</text></g><g class=\"element\" transform=\"translate(200,12)\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"32\"></rect><text dy=\".35em\" x=\"6\">div</text></g><g class=\"code datum\" transform=\"translate(300,12)\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"78\"></rect><text dy=\".35em\" x=\"6\">{name: \"A\"}</text></g><g class=\"element\" transform=\"translate(200,36)\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"32\"></rect><text dy=\".35em\" x=\"6\">div</text></g><g class=\"code datum\" transform=\"translate(300,36)\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"78\"></rect><text dy=\".35em\" x=\"6\">{name: \"B\"}</text></g><g class=\"element\" transform=\"translate(200,60)\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"32\"></rect><text dy=\".35em\" x=\"6\">div</text></g><g class=\"code datum\" transform=\"translate(300,60)\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"78\"></rect><text dy=\".35em\" x=\"6\">{name: \"C\"}</text></g><g class=\"element\" transform=\"translate(200,84)\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"32\"></rect><text dy=\".35em\" x=\"6\">div</text></g><g class=\"code datum\" transform=\"translate(300,84)\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"78\"></rect><text dy=\".35em\" x=\"6\">{name: \"D\"}</text></g><g class=\"element\" transform=\"translate(200,108)\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"32\"></rect><text dy=\".35em\" x=\"6\">div</text></g><g class=\"code datum\" transform=\"translate(300,108)\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"78\"></rect><text dy=\".35em\" x=\"6\">{name: \"E\"}</text></g></g></g></svg>\n\n<p>This process can be quite complicated for large grouped selections, but is simplified somewhat because <b>each group is joined independently</b>. Thus, you only need to worry about unique keys within a group, not across the entire selection.\n\n<script>\n\ntree(\n  {type: \"selection\", name: \"selection\", children: [\n    {type: \"array\", name: \"group\", children: [\n      {type: \"element\", name: \"element\", children: [{type: \"key\", name: \"B\", join: 1}]},\n      {type: \"element\", name: \"element\", children: [{type: \"key\", name: \"C\", join: 1}]},\n      {type: \"element\", name: \"element\", children: [{type: \"key\", name: \"D\", join: 1}]},\n      {type: \"element\", name: \"element\", children: [{type: \"key\", name: \"A\", join: -3}]}\n    ]},\n    {type: \"array\", name: \"group\", children: [\n      {type: \"element\", name: \"element\", children: [{type: \"key\", name: \"A\", join: 0}]},\n      {type: \"element\", name: \"element\", children: [{type: \"key\", name: \"B\", join: 0}]},\n      {type: \"element\", name: \"element\", children: [{type: \"key\", name: \"D\", join: 1}]},\n      {type: \"element\", name: \"element\", children: [{type: \"key\", name: \"C\", join: -1}]}\n    ]},\n    {type: \"array\", name: \"group\", children: [\n      {type: \"element\", name: \"element\", children: [{type: \"key\", name: \"A\", join: 0}]},\n      {type: \"element\", name: \"element\", children: [{type: \"key\", name: \"D\", join: +2}]},\n      {type: \"element\", name: \"element\", children: [{type: \"key\", name: \"B\", join: 0}]},\n      {type: \"element\", name: \"element\", children: [{type: \"key\", name: \"C\", join: -2}]}\n    ]},\n    {type: \"array\", name: \"group\", children: [\n      {type: \"element\", name: \"element\", children: [{type: \"key\", name: \"C\", join: +2}]},\n      {type: \"element\", name: \"element\", children: [{type: \"key\", name: \"D\", join: +2}]},\n      {type: \"element\", name: \"element\", children: [{type: \"key\", name: \"A\", join: -2}]},\n      {type: \"element\", name: \"element\", children: [{type: \"key\", name: \"B\", join: -2}]}\n    ]}\n  ]},\n  {type: \"data\", name: \"data\", children: [\n    {type: \"array\", name: \"array\", children: [\n      {type: \"datum\", name: \"A\", children: [{type: \"key\", name: \"A\"}]},\n      {type: \"datum\", name: \"B\", children: [{type: \"key\", name: \"B\"}]},\n      {type: \"datum\", name: \"C\", children: [{type: \"key\", name: \"C\"}]},\n      {type: \"datum\", name: \"D\", children: [{type: \"key\", name: \"D\"}]}\n    ]},\n    {type: \"array\", name: \"array\", children: [\n      {type: \"datum\", name: \"A\", children: [{type: \"key\", name: \"A\"}]},\n      {type: \"datum\", name: \"B\", children: [{type: \"key\", name: \"B\"}]},\n      {type: \"datum\", name: \"C\", children: [{type: \"key\", name: \"C\"}]},\n      {type: \"datum\", name: \"D\", children: [{type: \"key\", name: \"D\"}]}\n    ]},\n    {type: \"array\", name: \"array\", children: [\n      {type: \"datum\", name: \"A\", children: [{type: \"key\", name: \"A\"}]},\n      {type: \"datum\", name: \"B\", children: [{type: \"key\", name: \"B\"}]},\n      {type: \"datum\", name: \"C\", children: [{type: \"key\", name: \"C\"}]},\n      {type: \"datum\", name: \"D\", children: [{type: \"key\", name: \"D\"}]}\n    ]},\n    {type: \"array\", name: \"array\", children: [\n      {type: \"datum\", name: \"A\", children: [{type: \"key\", name: \"A\"}]},\n      {type: \"datum\", name: \"B\", children: [{type: \"key\", name: \"B\"}]},\n      {type: \"datum\", name: \"C\", children: [{type: \"key\", name: \"C\"}]},\n      {type: \"datum\", name: \"D\", children: [{type: \"key\", name: \"D\"}]}\n    ]}\n  ]},\n  24 * 16\n);\n\n</script>\n\n</p><svg width=\"800\" height=\"384\" style=\"margin: 1em 0px 1em -40px;\"><g class=\"left\" transform=\"translate(40,0)\"><g class=\"link\"><path class=\"to-array from-selection\" d=\"M66,192C83,192 83,48 100,48\"></path><path class=\"to-array from-selection\" d=\"M66,192C83,192 83,144 100,144\"></path><path class=\"to-array from-selection\" d=\"M66,192C83,192 83,240 100,240\"></path><path class=\"to-array from-selection\" d=\"M66,192C83,192 83,336 100,336\"></path><path class=\"to-element from-array\" d=\"M142,48C171,48 171,12 200,12\"></path><path class=\"to-element from-array\" d=\"M142,48C171,48 171,36 200,36\"></path><path class=\"to-element from-array\" d=\"M142,48C171,48 171,60 200,60\"></path><path class=\"to-element from-array\" d=\"M142,48C171,48 171,84 200,84\"></path><path class=\"to-key from-element\" d=\"M254,12C277,12 277,12 300,12\"></path><path class=\"to-key from-element\" d=\"M254,36C277,36 277,36 300,36\"></path><path class=\"to-key from-element\" d=\"M254,60C277,60 277,60 300,60\"></path><path class=\"to-key from-element\" d=\"M254,84C277,84 277,84 300,84\"></path><path class=\"to-element from-array\" d=\"M142,144C171,144 171,108 200,108\"></path><path class=\"to-element from-array\" d=\"M142,144C171,144 171,132 200,132\"></path><path class=\"to-element from-array\" d=\"M142,144C171,144 171,156 200,156\"></path><path class=\"to-element from-array\" d=\"M142,144C171,144 171,180 200,180\"></path><path class=\"to-key from-element\" d=\"M254,108C277,108 277,108 300,108\"></path><path class=\"to-key from-element\" d=\"M254,132C277,132 277,132 300,132\"></path><path class=\"to-key from-element\" d=\"M254,156C277,156 277,156 300,156\"></path><path class=\"to-key from-element\" d=\"M254,180C277,180 277,180 300,180\"></path><path class=\"to-element from-array\" d=\"M142,240C171,240 171,204 200,204\"></path><path class=\"to-element from-array\" d=\"M142,240C171,240 171,228 200,228\"></path><path class=\"to-element from-array\" d=\"M142,240C171,240 171,252 200,252\"></path><path class=\"to-element from-array\" d=\"M142,240C171,240 171,276 200,276\"></path><path class=\"to-key from-element\" d=\"M254,204C277,204 277,204 300,204\"></path><path class=\"to-key from-element\" d=\"M254,228C277,228 277,228 300,228\"></path><path class=\"to-key from-element\" d=\"M254,252C277,252 277,252 300,252\"></path><path class=\"to-key from-element\" d=\"M254,276C277,276 277,276 300,276\"></path><path class=\"to-element from-array\" d=\"M142,336C171,336 171,300 200,300\"></path><path class=\"to-element from-array\" d=\"M142,336C171,336 171,324 200,324\"></path><path class=\"to-element from-array\" d=\"M142,336C171,336 171,348 200,348\"></path><path class=\"to-element from-array\" d=\"M142,336C171,336 171,372 200,372\"></path><path class=\"to-key from-element\" d=\"M254,300C277,300 277,300 300,300\"></path><path class=\"to-key from-element\" d=\"M254,324C277,324 277,324 300,324\"></path><path class=\"to-key from-element\" d=\"M254,348C277,348 277,348 300,348\"></path><path class=\"to-key from-element\" d=\"M254,372C277,372 277,372 300,372\"></path></g><g class=\"node\"><g class=\"selection\" transform=\"translate(0,192)\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"66\"></rect><text dy=\".35em\" x=\"6\">selection</text></g><g class=\"array\" transform=\"translate(100,48)\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"42\"></rect><text dy=\".35em\" x=\"6\">group</text></g><g class=\"element\" transform=\"translate(200,12)\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"54\"></rect><text dy=\".35em\" x=\"6\">element</text></g><g class=\"key\" transform=\"translate(300,12)\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"32\"></rect><path class=\"join\" d=\"M32,0C60,0 60,24 88,24\"></path><text dy=\".35em\" x=\"6\">B</text></g><g class=\"element\" transform=\"translate(200,36)\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"54\"></rect><text dy=\".35em\" x=\"6\">element</text></g><g class=\"key\" transform=\"translate(300,36)\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"32\"></rect><path class=\"join\" d=\"M32,0C60,0 60,24 88,24\"></path><text dy=\".35em\" x=\"6\">C</text></g><g class=\"element\" transform=\"translate(200,60)\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"54\"></rect><text dy=\".35em\" x=\"6\">element</text></g><g class=\"key\" transform=\"translate(300,60)\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"32\"></rect><path class=\"join\" d=\"M32,0C60,0 60,24 88,24\"></path><text dy=\".35em\" x=\"6\">D</text></g><g class=\"element\" transform=\"translate(200,84)\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"54\"></rect><text dy=\".35em\" x=\"6\">element</text></g><g class=\"key\" transform=\"translate(300,84)\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"32\"></rect><path class=\"join\" d=\"M32,0C60,0 60,-72 88,-72\"></path><text dy=\".35em\" x=\"6\">A</text></g><g class=\"array\" transform=\"translate(100,144)\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"42\"></rect><text dy=\".35em\" x=\"6\">group</text></g><g class=\"element\" transform=\"translate(200,108)\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"54\"></rect><text dy=\".35em\" x=\"6\">element</text></g><g class=\"key\" transform=\"translate(300,108)\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"32\"></rect><path class=\"join\" d=\"M32,0C60,0 60,0 88,0\"></path><text dy=\".35em\" x=\"6\">A</text></g><g class=\"element\" transform=\"translate(200,132)\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"54\"></rect><text dy=\".35em\" x=\"6\">element</text></g><g class=\"key\" transform=\"translate(300,132)\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"32\"></rect><path class=\"join\" d=\"M32,0C60,0 60,0 88,0\"></path><text dy=\".35em\" x=\"6\">B</text></g><g class=\"element\" transform=\"translate(200,156)\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"54\"></rect><text dy=\".35em\" x=\"6\">element</text></g><g class=\"key\" transform=\"translate(300,156)\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"32\"></rect><path class=\"join\" d=\"M32,0C60,0 60,24 88,24\"></path><text dy=\".35em\" x=\"6\">D</text></g><g class=\"element\" transform=\"translate(200,180)\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"54\"></rect><text dy=\".35em\" x=\"6\">element</text></g><g class=\"key\" transform=\"translate(300,180)\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"32\"></rect><path class=\"join\" d=\"M32,0C60,0 60,-24 88,-24\"></path><text dy=\".35em\" x=\"6\">C</text></g><g class=\"array\" transform=\"translate(100,240)\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"42\"></rect><text dy=\".35em\" x=\"6\">group</text></g><g class=\"element\" transform=\"translate(200,204)\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"54\"></rect><text dy=\".35em\" x=\"6\">element</text></g><g class=\"key\" transform=\"translate(300,204)\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"32\"></rect><path class=\"join\" d=\"M32,0C60,0 60,0 88,0\"></path><text dy=\".35em\" x=\"6\">A</text></g><g class=\"element\" transform=\"translate(200,228)\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"54\"></rect><text dy=\".35em\" x=\"6\">element</text></g><g class=\"key\" transform=\"translate(300,228)\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"32\"></rect><path class=\"join\" d=\"M32,0C60,0 60,48 88,48\"></path><text dy=\".35em\" x=\"6\">D</text></g><g class=\"element\" transform=\"translate(200,252)\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"54\"></rect><text dy=\".35em\" x=\"6\">element</text></g><g class=\"key\" transform=\"translate(300,252)\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"32\"></rect><path class=\"join\" d=\"M32,0C60,0 60,0 88,0\"></path><text dy=\".35em\" x=\"6\">B</text></g><g class=\"element\" transform=\"translate(200,276)\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"54\"></rect><text dy=\".35em\" x=\"6\">element</text></g><g class=\"key\" transform=\"translate(300,276)\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"32\"></rect><path class=\"join\" d=\"M32,0C60,0 60,-48 88,-48\"></path><text dy=\".35em\" x=\"6\">C</text></g><g class=\"array\" transform=\"translate(100,336)\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"42\"></rect><text dy=\".35em\" x=\"6\">group</text></g><g class=\"element\" transform=\"translate(200,300)\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"54\"></rect><text dy=\".35em\" x=\"6\">element</text></g><g class=\"key\" transform=\"translate(300,300)\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"32\"></rect><path class=\"join\" d=\"M32,0C60,0 60,48 88,48\"></path><text dy=\".35em\" x=\"6\">C</text></g><g class=\"element\" transform=\"translate(200,324)\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"54\"></rect><text dy=\".35em\" x=\"6\">element</text></g><g class=\"key\" transform=\"translate(300,324)\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"32\"></rect><path class=\"join\" d=\"M32,0C60,0 60,48 88,48\"></path><text dy=\".35em\" x=\"6\">D</text></g><g class=\"element\" transform=\"translate(200,348)\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"54\"></rect><text dy=\".35em\" x=\"6\">element</text></g><g class=\"key\" transform=\"translate(300,348)\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"32\"></rect><path class=\"join\" d=\"M32,0C60,0 60,-48 88,-48\"></path><text dy=\".35em\" x=\"6\">A</text></g><g class=\"element\" transform=\"translate(200,372)\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"54\"></rect><text dy=\".35em\" x=\"6\">element</text></g><g class=\"key\" transform=\"translate(300,372)\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"32\"></rect><path class=\"join\" d=\"M32,0C60,0 60,-48 88,-48\"></path><text dy=\".35em\" x=\"6\">B</text></g></g></g><g class=\"right\" transform=\"translate(760,0)\"><g class=\"link\"><path class=\"to-array from-data\" d=\"M-36,192C-68,192 -68,48 -100,48\"></path><path class=\"to-array from-data\" d=\"M-36,192C-68,192 -68,144 -100,144\"></path><path class=\"to-array from-data\" d=\"M-36,192C-68,192 -68,240 -100,240\"></path><path class=\"to-array from-data\" d=\"M-36,192C-68,192 -68,336 -100,336\"></path><path class=\"to-datum from-array\" d=\"M-142,48C-171,48 -171,12 -200,12\"></path><path class=\"to-datum from-array\" d=\"M-142,48C-171,48 -171,36 -200,36\"></path><path class=\"to-datum from-array\" d=\"M-142,48C-171,48 -171,60 -200,60\"></path><path class=\"to-datum from-array\" d=\"M-142,48C-171,48 -171,84 -200,84\"></path><path class=\"to-key from-datum\" d=\"M-232,12C-266,12 -266,12 -300,12\"></path><path class=\"to-key from-datum\" d=\"M-232,36C-266,36 -266,36 -300,36\"></path><path class=\"to-key from-datum\" d=\"M-232,60C-266,60 -266,60 -300,60\"></path><path class=\"to-key from-datum\" d=\"M-232,84C-266,84 -266,84 -300,84\"></path><path class=\"to-datum from-array\" d=\"M-142,144C-171,144 -171,108 -200,108\"></path><path class=\"to-datum from-array\" d=\"M-142,144C-171,144 -171,132 -200,132\"></path><path class=\"to-datum from-array\" d=\"M-142,144C-171,144 -171,156 -200,156\"></path><path class=\"to-datum from-array\" d=\"M-142,144C-171,144 -171,180 -200,180\"></path><path class=\"to-key from-datum\" d=\"M-232,108C-266,108 -266,108 -300,108\"></path><path class=\"to-key from-datum\" d=\"M-232,132C-266,132 -266,132 -300,132\"></path><path class=\"to-key from-datum\" d=\"M-232,156C-266,156 -266,156 -300,156\"></path><path class=\"to-key from-datum\" d=\"M-232,180C-266,180 -266,180 -300,180\"></path><path class=\"to-datum from-array\" d=\"M-142,240C-171,240 -171,204 -200,204\"></path><path class=\"to-datum from-array\" d=\"M-142,240C-171,240 -171,228 -200,228\"></path><path class=\"to-datum from-array\" d=\"M-142,240C-171,240 -171,252 -200,252\"></path><path class=\"to-datum from-array\" d=\"M-142,240C-171,240 -171,276 -200,276\"></path><path class=\"to-key from-datum\" d=\"M-232,204C-266,204 -266,204 -300,204\"></path><path class=\"to-key from-datum\" d=\"M-232,228C-266,228 -266,228 -300,228\"></path><path class=\"to-key from-datum\" d=\"M-232,252C-266,252 -266,252 -300,252\"></path><path class=\"to-key from-datum\" d=\"M-232,276C-266,276 -266,276 -300,276\"></path><path class=\"to-datum from-array\" d=\"M-142,336C-171,336 -171,300 -200,300\"></path><path class=\"to-datum from-array\" d=\"M-142,336C-171,336 -171,324 -200,324\"></path><path class=\"to-datum from-array\" d=\"M-142,336C-171,336 -171,348 -200,348\"></path><path class=\"to-datum from-array\" d=\"M-142,336C-171,336 -171,372 -200,372\"></path><path class=\"to-key from-datum\" d=\"M-232,300C-266,300 -266,300 -300,300\"></path><path class=\"to-key from-datum\" d=\"M-232,324C-266,324 -266,324 -300,324\"></path><path class=\"to-key from-datum\" d=\"M-232,348C-266,348 -266,348 -300,348\"></path><path class=\"to-key from-datum\" d=\"M-232,372C-266,372 -266,372 -300,372\"></path></g><g class=\"node\"><g class=\"data\" transform=\"translate(0,192)\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"36\" x=\"-36\"></rect><text dy=\".35em\" x=\"-30\">data</text></g><g class=\"array\" transform=\"translate(-100,48)\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"42\" x=\"-42\"></rect><text dy=\".35em\" x=\"-36\">array</text></g><g class=\"datum\" transform=\"translate(-200,12)\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"32\" x=\"-32\"></rect><text dy=\".35em\" x=\"-26\">A</text></g><g class=\"key\" transform=\"translate(-300,12)\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"32\" x=\"-32\"></rect><text dy=\".35em\" x=\"-26\">A</text></g><g class=\"datum\" transform=\"translate(-200,36)\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"32\" x=\"-32\"></rect><text dy=\".35em\" x=\"-26\">B</text></g><g class=\"key\" transform=\"translate(-300,36)\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"32\" x=\"-32\"></rect><text dy=\".35em\" x=\"-26\">B</text></g><g class=\"datum\" transform=\"translate(-200,60)\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"32\" x=\"-32\"></rect><text dy=\".35em\" x=\"-26\">C</text></g><g class=\"key\" transform=\"translate(-300,60)\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"32\" x=\"-32\"></rect><text dy=\".35em\" x=\"-26\">C</text></g><g class=\"datum\" transform=\"translate(-200,84)\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"32\" x=\"-32\"></rect><text dy=\".35em\" x=\"-26\">D</text></g><g class=\"key\" transform=\"translate(-300,84)\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"32\" x=\"-32\"></rect><text dy=\".35em\" x=\"-26\">D</text></g><g class=\"array\" transform=\"translate(-100,144)\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"42\" x=\"-42\"></rect><text dy=\".35em\" x=\"-36\">array</text></g><g class=\"datum\" transform=\"translate(-200,108)\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"32\" x=\"-32\"></rect><text dy=\".35em\" x=\"-26\">A</text></g><g class=\"key\" transform=\"translate(-300,108)\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"32\" x=\"-32\"></rect><text dy=\".35em\" x=\"-26\">A</text></g><g class=\"datum\" transform=\"translate(-200,132)\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"32\" x=\"-32\"></rect><text dy=\".35em\" x=\"-26\">B</text></g><g class=\"key\" transform=\"translate(-300,132)\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"32\" x=\"-32\"></rect><text dy=\".35em\" x=\"-26\">B</text></g><g class=\"datum\" transform=\"translate(-200,156)\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"32\" x=\"-32\"></rect><text dy=\".35em\" x=\"-26\">C</text></g><g class=\"key\" transform=\"translate(-300,156)\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"32\" x=\"-32\"></rect><text dy=\".35em\" x=\"-26\">C</text></g><g class=\"datum\" transform=\"translate(-200,180)\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"32\" x=\"-32\"></rect><text dy=\".35em\" x=\"-26\">D</text></g><g class=\"key\" transform=\"translate(-300,180)\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"32\" x=\"-32\"></rect><text dy=\".35em\" x=\"-26\">D</text></g><g class=\"array\" transform=\"translate(-100,240)\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"42\" x=\"-42\"></rect><text dy=\".35em\" x=\"-36\">array</text></g><g class=\"datum\" transform=\"translate(-200,204)\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"32\" x=\"-32\"></rect><text dy=\".35em\" x=\"-26\">A</text></g><g class=\"key\" transform=\"translate(-300,204)\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"32\" x=\"-32\"></rect><text dy=\".35em\" x=\"-26\">A</text></g><g class=\"datum\" transform=\"translate(-200,228)\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"32\" x=\"-32\"></rect><text dy=\".35em\" x=\"-26\">B</text></g><g class=\"key\" transform=\"translate(-300,228)\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"32\" x=\"-32\"></rect><text dy=\".35em\" x=\"-26\">B</text></g><g class=\"datum\" transform=\"translate(-200,252)\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"32\" x=\"-32\"></rect><text dy=\".35em\" x=\"-26\">C</text></g><g class=\"key\" transform=\"translate(-300,252)\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"32\" x=\"-32\"></rect><text dy=\".35em\" x=\"-26\">C</text></g><g class=\"datum\" transform=\"translate(-200,276)\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"32\" x=\"-32\"></rect><text dy=\".35em\" x=\"-26\">D</text></g><g class=\"key\" transform=\"translate(-300,276)\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"32\" x=\"-32\"></rect><text dy=\".35em\" x=\"-26\">D</text></g><g class=\"array\" transform=\"translate(-100,336)\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"42\" x=\"-42\"></rect><text dy=\".35em\" x=\"-36\">array</text></g><g class=\"datum\" transform=\"translate(-200,300)\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"32\" x=\"-32\"></rect><text dy=\".35em\" x=\"-26\">A</text></g><g class=\"key\" transform=\"translate(-300,300)\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"32\" x=\"-32\"></rect><text dy=\".35em\" x=\"-26\">A</text></g><g class=\"datum\" transform=\"translate(-200,324)\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"32\" x=\"-32\"></rect><text dy=\".35em\" x=\"-26\">B</text></g><g class=\"key\" transform=\"translate(-300,324)\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"32\" x=\"-32\"></rect><text dy=\".35em\" x=\"-26\">B</text></g><g class=\"datum\" transform=\"translate(-200,348)\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"32\" x=\"-32\"></rect><text dy=\".35em\" x=\"-26\">C</text></g><g class=\"key\" transform=\"translate(-300,348)\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"32\" x=\"-32\"></rect><text dy=\".35em\" x=\"-26\">C</text></g><g class=\"datum\" transform=\"translate(-200,372)\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"32\" x=\"-32\"></rect><text dy=\".35em\" x=\"-26\">D</text></g><g class=\"key\" transform=\"translate(-300,372)\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"32\" x=\"-32\"></rect><text dy=\".35em\" x=\"-26\">D</text></g></g></g></svg><aside>You can read more about key functions in my previous tutorial on <a href=\"../constancy/\">object constancy</a>.</aside>\n\n<p>The above examples assume an exact 1:1 match between data and elements. But what happens when there’s no matching element for a given datum, or no matching datum for a given element?\n\n</p><h2><a href=\"#enter-update-exit\" name=\"enter-update-exit\">#</a>Enter, Update and Exit</h2>\n\n<p>When joining elements to data by key, there are three possible logical outcomes:</p><ul>\n\n  <li><i>Update</i> - There was a matching element for a given datum.\n  </li><li><i>Enter</i> - There was no matching element for a given datum.\n  </li><li><i>Exit</i> - There was no matching datum for a given element.\n\n</li></ul>\n\n<p>These are the three selections returned by <a href=\"https://github.com/mbostock/d3/wiki/Selections#wiki-data\">selection.data</a>, <a href=\"https://github.com/mbostock/d3/wiki/Selections#wiki-enter\">selection.enter</a> and <a href=\"https://github.com/mbostock/d3/wiki/Selections#wiki-exit\">selection.exit</a>, respectively. To illustrate, imagine you had a bar chart of the first five letters of the alphabet (ABCDE), and you want to transition to your five favorite vowels (YEAOI). You can use a key function to maintain association of letters to bars across the transition, resulting in the following data join:\n\n<script>\n\ntree(\n  {type: \"selection\", name: \"selection\", children: [\n    {type: \"array\", name: \"group\", children: [\n      {type: \"element\", name: \"element\", children: [{type: \"key\", name: \"A\", join: 2}]},\n      {type: \"element\", name: \"element\", children: [{type: \"key\", name: \"B\"}]},\n      {type: \"element\", name: \"element\", children: [{type: \"key\", name: \"C\"}]},\n      {type: \"element\", name: \"element\", children: [{type: \"key\", name: \"D\"}]},\n      {type: \"element\", name: \"element\", children: [{type: \"key\", name: \"E\", join: -3}]}\n    ]}\n  ]},\n  {type: \"data\", name: \"data\", children: [\n    {type: \"array\", name: \"array\", children: [\n      {type: \"datum\", name: \"Y\", children: [{type: \"key\", name: \"Y\"}]},\n      {type: \"datum\", name: \"E\", children: [{type: \"key\", name: \"E\"}]},\n      {type: \"datum\", name: \"A\", children: [{type: \"key\", name: \"A\"}]},\n      {type: \"datum\", name: \"O\", children: [{type: \"key\", name: \"O\"}]},\n      {type: \"datum\", name: \"I\", children: [{type: \"key\", name: \"I\"}]}\n    ]}\n  ]},\n  24 * 5\n);\n\n</script>\n\n</p><svg width=\"800\" height=\"120\" style=\"margin: 1em 0px 1em -40px;\"><g class=\"left\" transform=\"translate(40,0)\"><g class=\"link\"><path class=\"to-array from-selection\" d=\"M66,60C83,60 83,60 100,60\"></path><path class=\"to-element from-array\" d=\"M142,60C171,60 171,12 200,12\"></path><path class=\"to-element from-array\" d=\"M142,60C171,60 171,36 200,36\"></path><path class=\"to-element from-array\" d=\"M142,60C171,60 171,60 200,60\"></path><path class=\"to-element from-array\" d=\"M142,60C171,60 171,84 200,84\"></path><path class=\"to-element from-array\" d=\"M142,60C171,60 171,108 200,108\"></path><path class=\"to-key from-element\" d=\"M254,12C277,12 277,12 300,12\"></path><path class=\"to-key from-element\" d=\"M254,36C277,36 277,36 300,36\"></path><path class=\"to-key from-element\" d=\"M254,60C277,60 277,60 300,60\"></path><path class=\"to-key from-element\" d=\"M254,84C277,84 277,84 300,84\"></path><path class=\"to-key from-element\" d=\"M254,108C277,108 277,108 300,108\"></path></g><g class=\"node\"><g class=\"selection\" transform=\"translate(0,60)\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"66\"></rect><text dy=\".35em\" x=\"6\">selection</text></g><g class=\"array\" transform=\"translate(100,60)\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"42\"></rect><text dy=\".35em\" x=\"6\">group</text></g><g class=\"element\" transform=\"translate(200,12)\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"54\"></rect><text dy=\".35em\" x=\"6\">element</text></g><g class=\"key\" transform=\"translate(300,12)\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"32\"></rect><path class=\"join\" d=\"M32,0C60,0 60,48 88,48\"></path><text dy=\".35em\" x=\"6\">A</text></g><g class=\"element\" transform=\"translate(200,36)\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"54\"></rect><text dy=\".35em\" x=\"6\">element</text></g><g class=\"key\" transform=\"translate(300,36)\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"32\"></rect><text dy=\".35em\" x=\"6\">B</text></g><g class=\"element\" transform=\"translate(200,60)\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"54\"></rect><text dy=\".35em\" x=\"6\">element</text></g><g class=\"key\" transform=\"translate(300,60)\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"32\"></rect><text dy=\".35em\" x=\"6\">C</text></g><g class=\"element\" transform=\"translate(200,84)\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"54\"></rect><text dy=\".35em\" x=\"6\">element</text></g><g class=\"key\" transform=\"translate(300,84)\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"32\"></rect><text dy=\".35em\" x=\"6\">D</text></g><g class=\"element\" transform=\"translate(200,108)\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"54\"></rect><text dy=\".35em\" x=\"6\">element</text></g><g class=\"key\" transform=\"translate(300,108)\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"32\"></rect><path class=\"join\" d=\"M32,0C60,0 60,-72 88,-72\"></path><text dy=\".35em\" x=\"6\">E</text></g></g></g><g class=\"right\" transform=\"translate(760,0)\"><g class=\"link\"><path class=\"to-array from-data\" d=\"M-36,60C-68,60 -68,60 -100,60\"></path><path class=\"to-datum from-array\" d=\"M-142,60C-171,60 -171,12 -200,12\"></path><path class=\"to-datum from-array\" d=\"M-142,60C-171,60 -171,36 -200,36\"></path><path class=\"to-datum from-array\" d=\"M-142,60C-171,60 -171,60 -200,60\"></path><path class=\"to-datum from-array\" d=\"M-142,60C-171,60 -171,84 -200,84\"></path><path class=\"to-datum from-array\" d=\"M-142,60C-171,60 -171,108 -200,108\"></path><path class=\"to-key from-datum\" d=\"M-232,12C-266,12 -266,12 -300,12\"></path><path class=\"to-key from-datum\" d=\"M-232,36C-266,36 -266,36 -300,36\"></path><path class=\"to-key from-datum\" d=\"M-232,60C-266,60 -266,60 -300,60\"></path><path class=\"to-key from-datum\" d=\"M-232,84C-266,84 -266,84 -300,84\"></path><path class=\"to-key from-datum\" d=\"M-232,108C-266,108 -266,108 -300,108\"></path></g><g class=\"node\"><g class=\"data\" transform=\"translate(0,60)\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"36\" x=\"-36\"></rect><text dy=\".35em\" x=\"-30\">data</text></g><g class=\"array\" transform=\"translate(-100,60)\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"42\" x=\"-42\"></rect><text dy=\".35em\" x=\"-36\">array</text></g><g class=\"datum\" transform=\"translate(-200,12)\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"32\" x=\"-32\"></rect><text dy=\".35em\" x=\"-26\">Y</text></g><g class=\"key\" transform=\"translate(-300,12)\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"32\" x=\"-32\"></rect><text dy=\".35em\" x=\"-26\">Y</text></g><g class=\"datum\" transform=\"translate(-200,36)\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"32\" x=\"-32\"></rect><text dy=\".35em\" x=\"-26\">E</text></g><g class=\"key\" transform=\"translate(-300,36)\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"32\" x=\"-32\"></rect><text dy=\".35em\" x=\"-26\">E</text></g><g class=\"datum\" transform=\"translate(-200,60)\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"32\" x=\"-32\"></rect><text dy=\".35em\" x=\"-26\">A</text></g><g class=\"key\" transform=\"translate(-300,60)\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"32\" x=\"-32\"></rect><text dy=\".35em\" x=\"-26\">A</text></g><g class=\"datum\" transform=\"translate(-200,84)\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"32\" x=\"-32\"></rect><text dy=\".35em\" x=\"-26\">O</text></g><g class=\"key\" transform=\"translate(-300,84)\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"32\" x=\"-32\"></rect><text dy=\".35em\" x=\"-26\">O</text></g><g class=\"datum\" transform=\"translate(-200,108)\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"32\" x=\"-32\"></rect><text dy=\".35em\" x=\"-26\">I</text></g><g class=\"key\" transform=\"translate(-300,108)\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"32\" x=\"-32\"></rect><text dy=\".35em\" x=\"-26\">I</text></g></g></g></svg><p>Two of the previously-displayed letters (A and E) are vowels. These bars are therefore placed in the <b>update</b> selection, in order of the new data:\n\n</p><pre><code class=\"javascript\"><span class=\"keyword\">var</span> div = d3.selectAll(<span class=\"string\">\"div\"</span>).data(vowels, name);</code></pre>\n\n<aside>The enter and update selections match the order of the new dataset. New data replaces old data in the update selection.</aside>\n\n<script>\n\nupdateAnimation(\n  {type: \"selection\", name: \"selection\", children: [\n    {type: \"array\", name: \"group\", children: [\n      {type: \"element\", name: \"element\", children: [{type: \"key\", name: \"A\", join: 2}]},\n      {type: \"element\", name: \"element\", children: [{type: \"key\", name: \"B\"}]},\n      {type: \"element\", name: \"element\", children: [{type: \"key\", name: \"C\"}]},\n      {type: \"element\", name: \"element\", children: [{type: \"key\", name: \"D\"}]},\n      {type: \"element\", name: \"element\", children: [{type: \"key\", name: \"E\", join: -3}]}\n    ]}\n  ]},\n  {type: \"data\", name: \"data\", children: [\n    {type: \"array\", name: \"array\", children: [\n      {type: \"datum\", name: \"Y\", children: [{type: \"key\", name: \"Y\"}]},\n      {type: \"datum\", name: \"E\", children: [{type: \"key\", name: \"E\"}]},\n      {type: \"datum\", name: \"A\", children: [{type: \"key\", name: \"A\"}]},\n      {type: \"datum\", name: \"O\", children: [{type: \"key\", name: \"O\"}]},\n      {type: \"datum\", name: \"I\", children: [{type: \"key\", name: \"I\"}]}\n    ]}\n  ]},\n  {type: \"selection\", name: \"selection\", children: [\n    {type: \"array\", name: \"group\", children: [\n      {type: \"null\", name: \"null\"},\n      {type: \"element\", name: \"element\", children: [{type: \"datum\", name: \"E\"}]},\n      {type: \"element\", name: \"element\", children: [{type: \"datum\", name: \"A\"}]},\n      {type: \"null\", name: \"null\"},\n      {type: \"null\", name: \"null\"}\n    ]}\n  ]},\n  24 * 5\n);\n\n</script><svg width=\"800\" height=\"120\" style=\"margin: 1em 0px 1em -40px;\"><g class=\"left\" transform=\"translate(40,0)\"><g class=\"link\"><path class=\"to-array from-selection\" d=\"M66,60C83,60 83,60 100,60\"></path><path class=\"to-null from-array\" d=\"M142,60C171,60 171,12 200,12\"></path><path class=\"to-element from-array\" d=\"M142,60C171,60 171,36 200,36\"></path><path class=\"to-element from-array\" d=\"M142,60C171,60 171,60 200,60\"></path><path class=\"to-null from-array\" d=\"M142,60C171,60 171,84 200,84\"></path><path class=\"to-null from-array\" d=\"M142,60C171,60 171,108 200,108\"></path><path class=\"to-datum from-element\" d=\"M254,36C277,36 277,36 300,36\"></path><path class=\"to-datum from-element\" d=\"M254,60C277,60 277,60 300,60\"></path></g><g class=\"node\"><g class=\"selection\" transform=\"translate(0,60)\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"66\"></rect><text dy=\".35em\" x=\"6\">selection</text></g><g class=\"array\" transform=\"translate(100,60)\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"42\"></rect><text dy=\".35em\" x=\"6\">group</text></g><g class=\"null\" transform=\"translate(200,12)\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"36\"></rect><text dy=\".35em\" x=\"6\">null</text></g><g class=\"element\" transform=\"translate(200,36)\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"54\"></rect><text dy=\".35em\" x=\"6\">element</text></g><g class=\"datum\" transform=\"translate(300,36)\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"32\"></rect><text dy=\".35em\" x=\"6\">E</text></g><g class=\"element\" transform=\"translate(200,60)\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"54\"></rect><text dy=\".35em\" x=\"6\">element</text></g><g class=\"datum\" transform=\"translate(300,60)\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"32\"></rect><text dy=\".35em\" x=\"6\">A</text></g><g class=\"null\" transform=\"translate(200,84)\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"36\"></rect><text dy=\".35em\" x=\"6\">null</text></g><g class=\"null\" transform=\"translate(200,108)\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"36\"></rect><text dy=\".35em\" x=\"6\">null</text></g></g></g><g class=\"left\" transform=\"translate(40,0)\" style=\"stroke-opacity: 1; fill-opacity: 1; display: none;\"><g class=\"link\"><path class=\"to-array from-selection\" d=\"M66,60C83,60 83,60 100,60\"></path><path class=\"to-element from-array\" d=\"M142,60C171,60 171,12 200,12\"></path><path class=\"to-element from-array\" d=\"M142,60C171,60 171,36 200,36\" style=\"\"></path><path class=\"to-element from-array\" d=\"M142,60C171,60 171,60 200,60\" style=\"\"></path><path class=\"to-element from-array\" d=\"M142,60C171,60 171,84 200,84\" style=\"\"></path><path class=\"to-element from-array\" d=\"M142,60C171,60 171,108 200,108\"></path><path class=\"to-key from-element\" d=\"M254,12C277,12 277,12 300,12\"></path><path class=\"to-key from-element\" d=\"M254,36C277,36 277,36 300,36\" style=\"\"></path><path class=\"to-key from-element\" d=\"M254,60C277,60 277,60 300,60\" style=\"\"></path><path class=\"to-key from-element\" d=\"M254,84C277,84 277,84 300,84\" style=\"\"></path><path class=\"to-key from-element\" d=\"M254,108C277,108 277,108 300,108\"></path></g><g class=\"node\"><g class=\"selection\" transform=\"translate(0,60)\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"66\"></rect><text dy=\".35em\" x=\"6\">selection</text></g><g class=\"array\" transform=\"translate(100,60)\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"42\"></rect><text dy=\".35em\" x=\"6\">group</text></g><g class=\"key\" transform=\"translate(300,12)\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"32\"></rect><path class=\"join\" d=\"M32,0C60,0 60,48 88,48\"></path><text dy=\".35em\" x=\"6\">A</text></g><g class=\"key\" transform=\"translate(300,36)\" style=\"\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"32\"></rect><text dy=\".35em\" x=\"6\">B</text></g><g class=\"key\" transform=\"translate(300,60)\" style=\"\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"32\"></rect><text dy=\".35em\" x=\"6\">C</text></g><g class=\"key\" transform=\"translate(300,84)\" style=\"\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"32\"></rect><text dy=\".35em\" x=\"6\">D</text></g><g class=\"key\" transform=\"translate(300,108)\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"32\"></rect><path class=\"join\" d=\"M32,0C60,0 60,-72 88,-72\"></path><text dy=\".35em\" x=\"6\">E</text></g><g class=\"element\" transform=\"translate(200,12)\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"54\"></rect><text dy=\".35em\" x=\"6\">element</text></g><g class=\"element\" transform=\"translate(200,36)\" style=\"\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"54\"></rect><text dy=\".35em\" x=\"6\">element</text></g><g class=\"element\" transform=\"translate(200,60)\" style=\"\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"54\"></rect><text dy=\".35em\" x=\"6\">element</text></g><g class=\"element\" transform=\"translate(200,84)\" style=\"\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"54\"></rect><text dy=\".35em\" x=\"6\">element</text></g><g class=\"element\" transform=\"translate(200,108)\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"54\"></rect><text dy=\".35em\" x=\"6\">element</text></g></g></g><g class=\"right\" transform=\"translate(760,0)\" style=\"stroke-opacity: 1; fill-opacity: 1; display: none;\"><g class=\"link\"><path class=\"to-array from-data\" d=\"M-36,60C-68,60 -68,60 -100,60\" style=\"\"></path><path class=\"to-datum from-array\" d=\"M-142,60C-171,60 -171,12 -200,12\" style=\"\"></path><path class=\"to-datum from-array\" d=\"M-142,60C-171,60 -171,36 -200,36\" style=\"\"></path><path class=\"to-datum from-array\" d=\"M-142,60C-171,60 -171,60 -200,60\" style=\"\"></path><path class=\"to-datum from-array\" d=\"M-142,60C-171,60 -171,84 -200,84\" style=\"\"></path><path class=\"to-datum from-array\" d=\"M-142,60C-171,60 -171,108 -200,108\" style=\"\"></path><path class=\"to-key from-datum\" d=\"M-232,12C-266,12 -266,12 -300,12\" style=\"\"></path><path class=\"to-key from-datum joined\" d=\"M-232,36C-266,36 -266,36 -300,36\"></path><path class=\"to-key from-datum joined\" d=\"M-232,60C-266,60 -266,60 -300,60\"></path><path class=\"to-key from-datum\" d=\"M-232,84C-266,84 -266,84 -300,84\" style=\"\"></path><path class=\"to-key from-datum\" d=\"M-232,108C-266,108 -266,108 -300,108\" style=\"\"></path></g><g class=\"node\"><g class=\"data\" transform=\"translate(0,60)\" style=\"\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"36\" x=\"-36\"></rect><text dy=\".35em\" x=\"-30\">data</text></g><g class=\"array\" transform=\"translate(-100,60)\" style=\"\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"42\" x=\"-42\"></rect><text dy=\".35em\" x=\"-36\">array</text></g><g class=\"key\" transform=\"translate(-300,12)\" style=\"\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"32\" x=\"-32\"></rect><text dy=\".35em\" x=\"-26\">Y</text></g><g class=\"key joined\" transform=\"translate(-300,36)\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"32\" x=\"-32\"></rect><text dy=\".35em\" x=\"-26\">E</text></g><g class=\"key joined\" transform=\"translate(-300,60)\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"32\" x=\"-32\"></rect><text dy=\".35em\" x=\"-26\">A</text></g><g class=\"key\" transform=\"translate(-300,84)\" style=\"\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"32\" x=\"-32\"></rect><text dy=\".35em\" x=\"-26\">O</text></g><g class=\"key\" transform=\"translate(-300,108)\" style=\"\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"32\" x=\"-32\"></rect><text dy=\".35em\" x=\"-26\">I</text></g><g class=\"datum\" transform=\"translate(-200,12)\" style=\"\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"32\" x=\"-32\"></rect><text dy=\".35em\" x=\"-26\">Y</text></g><g class=\"datum joined\" transform=\"translate(-200,36)\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"32\" x=\"-32\"></rect><text dy=\".35em\" x=\"-26\">E</text></g><g class=\"datum joined\" transform=\"translate(-200,60)\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"32\" x=\"-32\"></rect><text dy=\".35em\" x=\"-26\">A</text></g><g class=\"datum\" transform=\"translate(-200,84)\" style=\"\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"32\" x=\"-32\"></rect><text dy=\".35em\" x=\"-26\">O</text></g><g class=\"datum\" transform=\"translate(-200,108)\" style=\"\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"32\" x=\"-32\"></rect><text dy=\".35em\" x=\"-26\">I</text></g></g></g><g class=\"play\"><circle r=\"45\" transform=\"translate(400,60)\"></circle><path d=\"M-22,-30l60,30l-60,30z\" transform=\"translate(400,60)scale(.7)\"></path><rect width=\"720\" height=\"120\"></rect></g></svg>\n\n<p>The other three displayed letters (B, C and D) are consonants, and thus have no corresponding data in the new dataset. These elements are therefore placed in the <b>exit</b> selection. Note that the exit selection preserves the order of the original selection, which is sometimes useful when animating prior to removal:\n\n</p><pre><code class=\"javascript\">div.exit();</code></pre>\n\n<aside>The exit selection preserves the order, indexes and data of the old selection.</aside>\n\n<script>\n\nexitAnimation(\n  {type: \"selection\", name: \"selection\", children: [\n    {type: \"array\", name: \"group\", children: [\n      {type: \"element\", name: \"element\", children: [{type: \"key\", name: \"A\", join: 2}]},\n      {type: \"element\", name: \"element\", children: [{type: \"key\", name: \"B\"}]},\n      {type: \"element\", name: \"element\", children: [{type: \"key\", name: \"C\"}]},\n      {type: \"element\", name: \"element\", children: [{type: \"key\", name: \"D\"}]},\n      {type: \"element\", name: \"element\", children: [{type: \"key\", name: \"E\", join: -3}]}\n    ]}\n  ]},\n  {type: \"data\", name: \"data\", children: [\n    {type: \"array\", name: \"array\", children: [\n      {type: \"datum\", name: \"Y\", children: [{type: \"key\", name: \"Y\"}]},\n      {type: \"datum\", name: \"E\", children: [{type: \"key\", name: \"E\"}]},\n      {type: \"datum\", name: \"A\", children: [{type: \"key\", name: \"A\"}]},\n      {type: \"datum\", name: \"O\", children: [{type: \"key\", name: \"O\"}]},\n      {type: \"datum\", name: \"I\", children: [{type: \"key\", name: \"I\"}]}\n    ]}\n  ]},\n  {type: \"selection\", name: \"selection\", children: [\n    {type: \"array\", name: \"group\", children: [\n      {type: \"null\", name: \"null\"},\n      {type: \"element\", name: \"element\", children: [{type: \"datum\", name: \"B\"}]},\n      {type: \"element\", name: \"element\", children: [{type: \"datum\", name: \"C\"}]},\n      {type: \"element\", name: \"element\", children: [{type: \"datum\", name: \"D\"}]},\n      {type: \"null\", name: \"null\"}\n    ]}\n  ]},\n  24 * 5\n);\n\n</script><svg width=\"800\" height=\"120\" style=\"margin: 1em 0px 1em -40px;\"><g class=\"left\" transform=\"translate(40,0)\"><g class=\"link\"><path class=\"to-array from-selection\" d=\"M66,60C83,60 83,60 100,60\"></path><path class=\"to-null from-array\" d=\"M142,60C171,60 171,12 200,12\"></path><path class=\"to-element from-array\" d=\"M142,60C171,60 171,36 200,36\"></path><path class=\"to-element from-array\" d=\"M142,60C171,60 171,60 200,60\"></path><path class=\"to-element from-array\" d=\"M142,60C171,60 171,84 200,84\"></path><path class=\"to-null from-array\" d=\"M142,60C171,60 171,108 200,108\"></path><path class=\"to-datum from-element\" d=\"M254,36C277,36 277,36 300,36\"></path><path class=\"to-datum from-element\" d=\"M254,60C277,60 277,60 300,60\"></path><path class=\"to-datum from-element\" d=\"M254,84C277,84 277,84 300,84\"></path></g><g class=\"node\"><g class=\"selection\" transform=\"translate(0,60)\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"66\"></rect><text dy=\".35em\" x=\"6\">selection</text></g><g class=\"array\" transform=\"translate(100,60)\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"42\"></rect><text dy=\".35em\" x=\"6\">group</text></g><g class=\"null\" transform=\"translate(200,12)\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"36\"></rect><text dy=\".35em\" x=\"6\">null</text></g><g class=\"element\" transform=\"translate(200,36)\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"54\"></rect><text dy=\".35em\" x=\"6\">element</text></g><g class=\"datum\" transform=\"translate(300,36)\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"32\"></rect><text dy=\".35em\" x=\"6\">B</text></g><g class=\"element\" transform=\"translate(200,60)\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"54\"></rect><text dy=\".35em\" x=\"6\">element</text></g><g class=\"datum\" transform=\"translate(300,60)\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"32\"></rect><text dy=\".35em\" x=\"6\">C</text></g><g class=\"element\" transform=\"translate(200,84)\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"54\"></rect><text dy=\".35em\" x=\"6\">element</text></g><g class=\"datum\" transform=\"translate(300,84)\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"32\"></rect><text dy=\".35em\" x=\"6\">D</text></g><g class=\"null\" transform=\"translate(200,108)\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"36\"></rect><text dy=\".35em\" x=\"6\">null</text></g></g></g><g class=\"left\" transform=\"translate(40,0)\" style=\"stroke-opacity: 0; fill-opacity: 0; display: none;\"><g class=\"link\"><path class=\"to-array from-selection\" d=\"M66,60C83,60 83,60 100,60\"></path><path class=\"to-element from-array\" d=\"M142,60C171,60 171,12 200,12\"></path><path class=\"to-element from-array\" d=\"M142,60C171,60 171,36 200,36\"></path><path class=\"to-element from-array\" d=\"M142,60C171,60 171,60 200,60\"></path><path class=\"to-element from-array\" d=\"M142,60C171,60 171,84 200,84\"></path><path class=\"to-element from-array\" d=\"M142,60C171,60 171,108 200,108\"></path><path class=\"to-key from-element\" d=\"M254,12C277,12 277,12 300,12\"></path><path class=\"to-key from-element\" d=\"M254,36C277,36 277,36 300,36\"></path><path class=\"to-key from-element\" d=\"M254,60C277,60 277,60 300,60\"></path><path class=\"to-key from-element\" d=\"M254,84C277,84 277,84 300,84\"></path><path class=\"to-key from-element\" d=\"M254,108C277,108 277,108 300,108\"></path></g><g class=\"node\"><g class=\"selection\" transform=\"translate(0,60)\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"66\"></rect><text dy=\".35em\" x=\"6\">selection</text></g><g class=\"array\" transform=\"translate(100,60)\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"42\"></rect><text dy=\".35em\" x=\"6\">group</text></g><g class=\"element\" transform=\"translate(200,12)\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"54\"></rect><text dy=\".35em\" x=\"6\">element</text></g><g class=\"key\" transform=\"translate(300,12)\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"32\"></rect><path class=\"join\" d=\"M32,0C60,0 60,48 88,48\"></path><text dy=\".35em\" x=\"6\">A</text></g><g class=\"element\" transform=\"translate(200,36)\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"54\"></rect><text dy=\".35em\" x=\"6\">element</text></g><g class=\"key\" transform=\"translate(300,36)\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"32\"></rect><text dy=\".35em\" x=\"6\">B</text></g><g class=\"element\" transform=\"translate(200,60)\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"54\"></rect><text dy=\".35em\" x=\"6\">element</text></g><g class=\"key\" transform=\"translate(300,60)\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"32\"></rect><text dy=\".35em\" x=\"6\">C</text></g><g class=\"element\" transform=\"translate(200,84)\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"54\"></rect><text dy=\".35em\" x=\"6\">element</text></g><g class=\"key\" transform=\"translate(300,84)\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"32\"></rect><text dy=\".35em\" x=\"6\">D</text></g><g class=\"element\" transform=\"translate(200,108)\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"54\"></rect><text dy=\".35em\" x=\"6\">element</text></g><g class=\"key\" transform=\"translate(300,108)\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"32\"></rect><path class=\"join\" d=\"M32,0C60,0 60,-72 88,-72\"></path><text dy=\".35em\" x=\"6\">E</text></g></g></g><g class=\"right\" transform=\"translate(760,0)\" style=\"stroke-opacity: 0; fill-opacity: 0; display: none;\"><g class=\"link\"><path class=\"to-array from-data\" d=\"M-36,60C-68,60 -68,60 -100,60\"></path><path class=\"to-datum from-array\" d=\"M-142,60C-171,60 -171,12 -200,12\"></path><path class=\"to-datum from-array\" d=\"M-142,60C-171,60 -171,36 -200,36\"></path><path class=\"to-datum from-array\" d=\"M-142,60C-171,60 -171,60 -200,60\"></path><path class=\"to-datum from-array\" d=\"M-142,60C-171,60 -171,84 -200,84\"></path><path class=\"to-datum from-array\" d=\"M-142,60C-171,60 -171,108 -200,108\"></path><path class=\"to-key from-datum\" d=\"M-232,12C-266,12 -266,12 -300,12\"></path><path class=\"to-key from-datum\" d=\"M-232,36C-266,36 -266,36 -300,36\"></path><path class=\"to-key from-datum\" d=\"M-232,60C-266,60 -266,60 -300,60\"></path><path class=\"to-key from-datum\" d=\"M-232,84C-266,84 -266,84 -300,84\"></path><path class=\"to-key from-datum\" d=\"M-232,108C-266,108 -266,108 -300,108\"></path></g><g class=\"node\"><g class=\"data\" transform=\"translate(0,60)\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"36\" x=\"-36\"></rect><text dy=\".35em\" x=\"-30\">data</text></g><g class=\"array\" transform=\"translate(-100,60)\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"42\" x=\"-42\"></rect><text dy=\".35em\" x=\"-36\">array</text></g><g class=\"datum\" transform=\"translate(-200,12)\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"32\" x=\"-32\"></rect><text dy=\".35em\" x=\"-26\">Y</text></g><g class=\"key\" transform=\"translate(-300,12)\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"32\" x=\"-32\"></rect><text dy=\".35em\" x=\"-26\">Y</text></g><g class=\"datum\" transform=\"translate(-200,36)\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"32\" x=\"-32\"></rect><text dy=\".35em\" x=\"-26\">E</text></g><g class=\"key\" transform=\"translate(-300,36)\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"32\" x=\"-32\"></rect><text dy=\".35em\" x=\"-26\">E</text></g><g class=\"datum\" transform=\"translate(-200,60)\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"32\" x=\"-32\"></rect><text dy=\".35em\" x=\"-26\">A</text></g><g class=\"key\" transform=\"translate(-300,60)\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"32\" x=\"-32\"></rect><text dy=\".35em\" x=\"-26\">A</text></g><g class=\"datum\" transform=\"translate(-200,84)\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"32\" x=\"-32\"></rect><text dy=\".35em\" x=\"-26\">O</text></g><g class=\"key\" transform=\"translate(-300,84)\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"32\" x=\"-32\"></rect><text dy=\".35em\" x=\"-26\">O</text></g><g class=\"datum\" transform=\"translate(-200,108)\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"32\" x=\"-32\"></rect><text dy=\".35em\" x=\"-26\">I</text></g><g class=\"key\" transform=\"translate(-300,108)\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"32\" x=\"-32\"></rect><text dy=\".35em\" x=\"-26\">I</text></g></g></g><g class=\"play\"><circle r=\"45\" transform=\"translate(400,60)\"></circle><path d=\"M-22,-30l60,30l-60,30z\" transform=\"translate(400,60)scale(.7)\"></path><rect width=\"720\" height=\"120\"></rect></g></svg>\n\n<p>Lastly, three of the vowels (Y, O and I) were not previously displayed, and thus have no corresponding element. These form the <b>enter</b> selection:\n\n</p><pre><code class=\"javascript\">div.enter();</code></pre>\n\n<aside>The placeholders in an enter selection are typically transient; the enter selection is replaced with a normal selection of elements when you call enter.append or enter.insert.</aside>\n\n<script>\n\nenterAnimation(\n  {type: \"selection\", name: \"selection\", children: [\n    {type: \"array\", name: \"group\", children: [\n      {type: \"element\", name: \"element\", children: [{type: \"key\", name: \"A\", join: 2}]},\n      {type: \"element\", name: \"element\", children: [{type: \"key\", name: \"B\"}]},\n      {type: \"element\", name: \"element\", children: [{type: \"key\", name: \"C\"}]},\n      {type: \"element\", name: \"element\", children: [{type: \"key\", name: \"D\"}]},\n      {type: \"element\", name: \"element\", children: [{type: \"key\", name: \"E\", join: -3}]}\n    ]}\n  ]},\n  {type: \"data\", name: \"data\", children: [\n    {type: \"array\", name: \"array\", children: [\n      {type: \"datum\", name: \"Y\", children: [{type: \"key\", name: \"Y\"}]},\n      {type: \"datum\", name: \"E\", children: [{type: \"key\", name: \"E\"}]},\n      {type: \"datum\", name: \"A\", children: [{type: \"key\", name: \"A\"}]},\n      {type: \"datum\", name: \"O\", children: [{type: \"key\", name: \"O\"}]},\n      {type: \"datum\", name: \"I\", children: [{type: \"key\", name: \"I\"}]}\n    ]}\n  ]},\n  {type: \"selection\", name: \"selection\", children: [\n    {type: \"array\", name: \"group\", children: [\n      {type: \"element\", name: \"placeholder\", children: [{type: \"datum\", name: \"Y\"}]},\n      {type: \"null\", name: \"null\"},\n      {type: \"null\", name: \"null\"},\n      {type: \"element\", name: \"placeholder\", children: [{type: \"datum\", name: \"O\"}]},\n      {type: \"element\", name: \"placeholder\", children: [{type: \"datum\", name: \"I\"}]}\n    ]}\n  ]},\n  24 * 5\n);\n\n</script><svg width=\"800\" height=\"120\" style=\"margin: 1em 0px 1em -40px;\"><g class=\"left\" transform=\"translate(40,0)\" style=\"stroke-opacity: 1; fill-opacity: 1; display: none;\"><g class=\"link\"><path class=\"to-array from-selection\" d=\"M66,60C83,60 83,60 100,60\"></path><path class=\"to-element from-array\" d=\"M142,60C171,60 171,12 200,12\" style=\"\"></path><path class=\"to-element from-array\" d=\"M142,60C171,60 171,36 200,36\" style=\"\"></path><path class=\"to-element from-array\" d=\"M142,60C171,60 171,60 200,60\" style=\"\"></path><path class=\"to-element from-array\" d=\"M142,60C171,60 171,84 200,84\" style=\"\"></path><path class=\"to-element from-array\" d=\"M142,60C171,60 171,108 200,108\" style=\"\"></path><path class=\"to-key from-element\" d=\"M254,12C277,12 277,12 300,12\" style=\"\"></path><path class=\"to-key from-element\" d=\"M254,36C277,36 277,36 300,36\" style=\"\"></path><path class=\"to-key from-element\" d=\"M254,60C277,60 277,60 300,60\" style=\"\"></path><path class=\"to-key from-element\" d=\"M254,84C277,84 277,84 300,84\" style=\"\"></path><path class=\"to-key from-element\" d=\"M254,108C277,108 277,108 300,108\" style=\"\"></path></g><g class=\"node\"><g class=\"selection\" transform=\"translate(0,60)\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"66\"></rect><text dy=\".35em\" x=\"6\">selection</text></g><g class=\"array\" transform=\"translate(100,60)\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"42\"></rect><text dy=\".35em\" x=\"6\">group</text></g><g class=\"element\" transform=\"translate(200,12)\" style=\"\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"54\"></rect><text dy=\".35em\" x=\"6\">element</text></g><g class=\"key\" transform=\"translate(300,12)\" style=\"\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"32\"></rect><path class=\"join\" d=\"M32,0C60,0 60,48 88,48\"></path><text dy=\".35em\" x=\"6\">A</text></g><g class=\"element\" transform=\"translate(200,36)\" style=\"\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"54\"></rect><text dy=\".35em\" x=\"6\">element</text></g><g class=\"key\" transform=\"translate(300,36)\" style=\"\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"32\"></rect><text dy=\".35em\" x=\"6\">B</text></g><g class=\"element\" transform=\"translate(200,60)\" style=\"\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"54\"></rect><text dy=\".35em\" x=\"6\">element</text></g><g class=\"key\" transform=\"translate(300,60)\" style=\"\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"32\"></rect><text dy=\".35em\" x=\"6\">C</text></g><g class=\"element\" transform=\"translate(200,84)\" style=\"\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"54\"></rect><text dy=\".35em\" x=\"6\">element</text></g><g class=\"key\" transform=\"translate(300,84)\" style=\"\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"32\"></rect><text dy=\".35em\" x=\"6\">D</text></g><g class=\"element\" transform=\"translate(200,108)\" style=\"\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"54\"></rect><text dy=\".35em\" x=\"6\">element</text></g><g class=\"key\" transform=\"translate(300,108)\" style=\"\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"32\"></rect><path class=\"join\" d=\"M32,0C60,0 60,-72 88,-72\"></path><text dy=\".35em\" x=\"6\">E</text></g></g></g><g class=\"right\" transform=\"translate(760,0)\" style=\"stroke-opacity: 1; fill-opacity: 1; display: none;\"><g class=\"link\"><path class=\"to-array from-data\" d=\"M-36,60C-68,60 -68,60 -100,60\" style=\"\"></path><path class=\"to-datum from-array\" d=\"M-142,60C-171,60 -171,12 -200,12\" style=\"\"></path><path class=\"to-datum from-array\" d=\"M-142,60C-171,60 -171,36 -200,36\" style=\"\"></path><path class=\"to-datum from-array\" d=\"M-142,60C-171,60 -171,60 -200,60\" style=\"\"></path><path class=\"to-datum from-array\" d=\"M-142,60C-171,60 -171,84 -200,84\" style=\"\"></path><path class=\"to-datum from-array\" d=\"M-142,60C-171,60 -171,108 -200,108\" style=\"\"></path><path class=\"to-key from-datum\" d=\"M-232,12C-266,12 -266,12 -300,12\" style=\"\"></path><path class=\"to-key from-datum joined\" d=\"M-232,36C-266,36 -266,36 -300,36\" style=\"\"></path><path class=\"to-key from-datum joined\" d=\"M-232,60C-266,60 -266,60 -300,60\" style=\"\"></path><path class=\"to-key from-datum\" d=\"M-232,84C-266,84 -266,84 -300,84\" style=\"\"></path><path class=\"to-key from-datum\" d=\"M-232,108C-266,108 -266,108 -300,108\" style=\"\"></path></g><g class=\"node\"><g class=\"data\" transform=\"translate(0,60)\" style=\"\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"36\" x=\"-36\"></rect><text dy=\".35em\" x=\"-30\">data</text></g><g class=\"array\" transform=\"translate(-100,60)\" style=\"\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"42\" x=\"-42\"></rect><text dy=\".35em\" x=\"-36\">array</text></g><g class=\"datum\" transform=\"translate(-200,12)\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"32\" x=\"-32\"></rect><text dy=\".35em\" x=\"-26\">Y</text></g><g class=\"key\" transform=\"translate(-300,12)\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"32\" x=\"-32\"></rect><text dy=\".35em\" x=\"-26\">Y</text></g><g class=\"datum joined\" transform=\"translate(-200,36)\" style=\"\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"32\" x=\"-32\"></rect><text dy=\".35em\" x=\"-26\">E</text></g><g class=\"key joined\" transform=\"translate(-300,36)\" style=\"\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"32\" x=\"-32\"></rect><text dy=\".35em\" x=\"-26\">E</text></g><g class=\"datum joined\" transform=\"translate(-200,60)\" style=\"\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"32\" x=\"-32\"></rect><text dy=\".35em\" x=\"-26\">A</text></g><g class=\"key joined\" transform=\"translate(-300,60)\" style=\"\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"32\" x=\"-32\"></rect><text dy=\".35em\" x=\"-26\">A</text></g><g class=\"datum\" transform=\"translate(-200,84)\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"32\" x=\"-32\"></rect><text dy=\".35em\" x=\"-26\">O</text></g><g class=\"key\" transform=\"translate(-300,84)\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"32\" x=\"-32\"></rect><text dy=\".35em\" x=\"-26\">O</text></g><g class=\"datum\" transform=\"translate(-200,108)\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"32\" x=\"-32\"></rect><text dy=\".35em\" x=\"-26\">I</text></g><g class=\"key\" transform=\"translate(-300,108)\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"32\" x=\"-32\"></rect><text dy=\".35em\" x=\"-26\">I</text></g></g></g><g class=\"left\" transform=\"translate(40,0)\"><g class=\"link\"><path class=\"to-array from-selection\" d=\"M66,60C83,60 83,60 100,60\"></path><path class=\"to-element from-array\" d=\"M142,60C171,60 171,12 200,12\"></path><path class=\"to-null from-array\" d=\"M142,60C171,60 171,36 200,36\"></path><path class=\"to-null from-array\" d=\"M142,60C171,60 171,60 200,60\"></path><path class=\"to-element from-array\" d=\"M142,60C171,60 171,84 200,84\"></path><path class=\"to-element from-array\" d=\"M142,60C171,60 171,108 200,108\"></path><path class=\"to-datum from-element\" d=\"M278,12C289,12 289,12 300,12\" style=\"\"></path><path class=\"to-datum from-element\" d=\"M278,84C289,84 289,84 300,84\" style=\"\"></path><path class=\"to-datum from-element\" d=\"M278,108C289,108 289,108 300,108\" style=\"\"></path></g><g class=\"node\"><g class=\"selection\" transform=\"translate(0,60)\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"66\"></rect><text dy=\".35em\" x=\"6\">selection</text></g><g class=\"array\" transform=\"translate(100,60)\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"42\"></rect><text dy=\".35em\" x=\"6\">group</text></g><g class=\"element\" transform=\"translate(200,12)\" style=\"\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"78\"></rect><text dy=\".35em\" x=\"6\">placeholder</text></g><g class=\"datum\" transform=\"translate(300,12)\" style=\"\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"32\"></rect><text dy=\".35em\" x=\"6\">Y</text></g><g class=\"null\" transform=\"translate(200,36)\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"36\"></rect><text dy=\".35em\" x=\"6\">null</text></g><g class=\"null\" transform=\"translate(200,60)\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"36\"></rect><text dy=\".35em\" x=\"6\">null</text></g><g class=\"element\" transform=\"translate(200,84)\" style=\"\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"78\"></rect><text dy=\".35em\" x=\"6\">placeholder</text></g><g class=\"datum\" transform=\"translate(300,84)\" style=\"\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"32\"></rect><text dy=\".35em\" x=\"6\">O</text></g><g class=\"element\" transform=\"translate(200,108)\" style=\"\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"78\"></rect><text dy=\".35em\" x=\"6\">placeholder</text></g><g class=\"datum\" transform=\"translate(300,108)\" style=\"\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"32\"></rect><text dy=\".35em\" x=\"6\">I</text></g></g></g><g class=\"play\"><circle r=\"45\" transform=\"translate(400,60)\"></circle><path d=\"M-22,-30l60,30l-60,30z\" transform=\"translate(400,60)scale(.7)\"></path><rect width=\"720\" height=\"120\"></rect></g></svg>\n\n<p>While update and exit are normal selections, enter is a subclass of selection. This is necessary because it represents elements that <i>do not yet exist</i>. An enter selection contains placeholders rather than DOM elements; these placeholders are simply objects with a <code class=\"javascript\">__data__</code> property. The implementation of <a href=\"https://github.com/mbostock/d3/blob/master/src/selection/enter-select.js\">enter.select</a> is then specialized such that nodes are inserted into the group’s parent, replacing the placeholder. This is why it is critical to call selection.selectAll prior to a data join: it establishes the parent node for entering elements.\n\n</p><h2><a href=\"#enter-update\" name=\"enter-update\">#</a>Merging Enter &amp; Update</h2>\n\n<p>The <a href=\"http://bl.ocks.org/mbostock/3808218\">general update pattern</a> with a data join appends entering elements and removes exiting elements, while modifying dynamic attributes, styles and other properties of updating elements. Often, there’s overlap between properties of updating and entering elements.\n\n</p><p>To reduce duplicate code, enter.append has a convenient side-effect: it replaces null elements in the update selection with the newly-created elements from the enter selection. Thus, after enter.append, the update selection is modified to contain both entering and updating elements. The update selection subsequently contains all currently-displayed elements:\n\n<script>\n\ntree(\n  {type: \"selection\", name: \"selection\", children: [\n    {type: \"array\", name: \"group\", children: [\n      {type: \"element\", name: \"element\", children: [{type: \"datum\", name: \"Y\"}]},\n      {type: \"element\", name: \"element\", children: [{type: \"datum\", name: \"E\"}]},\n      {type: \"element\", name: \"element\", children: [{type: \"datum\", name: \"A\"}]},\n      {type: \"element\", name: \"element\", children: [{type: \"datum\", name: \"O\"}]},\n      {type: \"element\", name: \"element\", children: [{type: \"datum\", name: \"I\"}]}\n    ]}\n  ]},\n  24 * 5\n);\n\n</script>\n\n</p><p>enter.append有一个方便的作用减少重复代码，它在update selection替换空元素。因此enter.appent后update selection被修改包含所有的entering元素和updateing元素。随后，update selection包含所有当前显示的元素。</p><svg width=\"800\" height=\"120\" style=\"margin: 1em 0px 1em -40px;\"><g class=\"left\" transform=\"translate(40,0)\"><g class=\"link\"><path class=\"to-array from-selection\" d=\"M66,60C83,60 83,60 100,60\"></path><path class=\"to-element from-array\" d=\"M142,60C171,60 171,12 200,12\"></path><path class=\"to-element from-array\" d=\"M142,60C171,60 171,36 200,36\"></path><path class=\"to-element from-array\" d=\"M142,60C171,60 171,60 200,60\"></path><path class=\"to-element from-array\" d=\"M142,60C171,60 171,84 200,84\"></path><path class=\"to-element from-array\" d=\"M142,60C171,60 171,108 200,108\"></path><path class=\"to-datum from-element\" d=\"M254,12C277,12 277,12 300,12\"></path><path class=\"to-datum from-element\" d=\"M254,36C277,36 277,36 300,36\"></path><path class=\"to-datum from-element\" d=\"M254,60C277,60 277,60 300,60\"></path><path class=\"to-datum from-element\" d=\"M254,84C277,84 277,84 300,84\"></path><path class=\"to-datum from-element\" d=\"M254,108C277,108 277,108 300,108\"></path></g><g class=\"node\"><g class=\"selection\" transform=\"translate(0,60)\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"66\"></rect><text dy=\".35em\" x=\"6\">selection</text></g><g class=\"array\" transform=\"translate(100,60)\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"42\"></rect><text dy=\".35em\" x=\"6\">group</text></g><g class=\"element\" transform=\"translate(200,12)\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"54\"></rect><text dy=\".35em\" x=\"6\">element</text></g><g class=\"datum\" transform=\"translate(300,12)\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"32\"></rect><text dy=\".35em\" x=\"6\">Y</text></g><g class=\"element\" transform=\"translate(200,36)\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"54\"></rect><text dy=\".35em\" x=\"6\">element</text></g><g class=\"datum\" transform=\"translate(300,36)\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"32\"></rect><text dy=\".35em\" x=\"6\">E</text></g><g class=\"element\" transform=\"translate(200,60)\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"54\"></rect><text dy=\".35em\" x=\"6\">element</text></g><g class=\"datum\" transform=\"translate(300,60)\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"32\"></rect><text dy=\".35em\" x=\"6\">A</text></g><g class=\"element\" transform=\"translate(200,84)\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"54\"></rect><text dy=\".35em\" x=\"6\">element</text></g><g class=\"datum\" transform=\"translate(300,84)\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"32\"></rect><text dy=\".35em\" x=\"6\">O</text></g><g class=\"element\" transform=\"translate(200,108)\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"54\"></rect><text dy=\".35em\" x=\"6\">element</text></g><g class=\"datum\" transform=\"translate(300,108)\"><rect ry=\"6\" rx=\"6\" y=\"-10\" height=\"20\" width=\"32\"></rect><text dy=\".35em\" x=\"6\">I</text></g></g></g></svg><p>With the selection once again consistent with the document, the life-cycle of the data join is complete.\n\n</p><h3 style=\"margin-top:8em;\">Acknowledgements</h3>\n\n<p>Thank you to Anna Powell-Smith, Scott Murray, Nelson Minar, Tom Carden, Shan Carter, Jason Davies, Tom MacWright and John Firebaugh for reviewing and providing feedback to improve this article.\n\n</p><h3>Further Reading</h3>\n\n<p>If you found this article informative, if you found parts unclear or confusing, or if you have followup questions or feedback, please let me know via <a href=\"https://twitter.com/mbostock\">Twitter</a> or <a href=\"https://news.ycombinator.com/item?id=5614421\">Hacker News</a>. To continue learning about selections, <a href=\"https://github.com/mbostock/d3/tree/master/src/selection/\">reading D3’s source</a> is a rigorous way to test your understanding. And here are several excellent talks and tutorials by others:\n\n</p><ul>\n  <li><a href=\"http://alignedleft.com/tutorials/d3/binding-data/\">Binding Data</a> by Scott Murray\n  </li><li><a href=\"http://www.rvl.io/annaps/d3-journey-to-the-source/\">Journey to the Source</a> by Anna Powell-Smith\n  </li><li><a href=\"http://macwright.org/presentations/dcjq/\">A Fun, Difficult Introduction to D3</a> by Tom MacWright\n</li></ul>\n\n<footer>\n  <aside>April 26, 2013</aside>\n  <a href=\"../\" rel=\"author\">Mike Bostock</a>\n</footer>\n\n<!-- You found me! -->\n<table style=\"position:absolute;top:-1000px;\">\n  <tbody><tr>\n    <td><span>0</span></td>\n    <td><span>1</span></td>\n    <td><span>2</span></td>\n    <td><span>3</span></td>\n  </tr>\n  <tr>\n    <td><span>4</span></td>\n    <td><span>5</span></td>\n    <td><span>6</span></td>\n    <td><span>7</span></td>\n  </tr>\n  <tr>\n    <td><span>8</span></td>\n    <td><span>9</span></td>\n    <td><span>10</span></td>\n    <td><span>11</span></td>\n  </tr>\n  <tr>\n    <td><span>12</span></td>\n    <td><span>13</span></td>\n    <td><span>14</span></td>\n    <td><span>15</span></td>\n  </tr>\n</tbody></table>\n\n<footer style=\"position:absolute;top:-1000px;\">\n  <section></section>\n  <section></section>\n  <section><aside>Hello!</aside></section>\n  <section><aside>There!</aside></section>\n</footer>\n\n<footer style=\"position:absolute;top:-1000px;\">\n  <div></div>\n  <div></div>\n  <div></div>\n  <div></div>\n  <div></div>\n</footer>\n\n<script>\n\nconsole.warn(\"Hooray, you opened the JavaScript console. Have fun!\");\n\n</script>\n<script>\n\nGoogleAnalyticsObject = \"ga\", ga = function() { ga.q.push(arguments); }, ga.q = [], ga.l = +new Date;\nga(\"create\", \"UA-48272912-3\", \"ocks.org\");\nga(\"send\", \"pageview\");\n\n</script>\n<script async=\"\" src=\"../highlight.min.js\"></script>\n<script async=\"\" src=\"//www.google-analytics.com/analytics.js\"></script>\n<style>.tb_button {padding:1px;cursor:pointer;border-right: 1px solid #8b8b8b;border-left: 1px solid #FFF;border-bottom: 1px solid #fff;}.tb_button.hover {borer:2px outset #def; background-color: #f8f8f8 !important;}.ws_toolbar {z-index:100000} .ws_toolbar .ws_tb_btn {cursor:pointer;border:1px solid #555;padding:3px}   .tb_highlight{background-color:yellow} .tb_hide {visibility:hidden} .ws_toolbar img {padding:2px;margin:0px}</style>"}